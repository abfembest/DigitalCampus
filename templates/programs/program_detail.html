{% extends 'base.html' %}
{% load static %}

{% block title %}{{ program.name }} | MIU – Melchisedec International University{% endblock %}

{% block meta_tags %}
<meta name="description" content="{{ program.meta_description|default:program.description|truncatewords:30 }}">
<meta name="keywords" content="{{ program.name }}, {{ program.get_degree_level_display }}, MIU, university program">
{% endblock %}

{% block canonical %}
<link rel="canonical" href="{{ request.build_absolute_uri }}">
{% endblock %}

{% block og_tags %}
<meta property="og:type" content="website">
<meta property="og:title" content="{{ program.name }} | MIU">
<meta property="og:description" content="{{ program.description|truncatewords:30 }}">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:image" content="{% static 'images/og-image.jpg' %}">
{% endblock %}

{% block twitter_tags %}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ program.name }} | MIU">
<meta name="twitter:description" content="{{ program.description|truncatewords:30 }}">
<meta name="twitter:image" content="{% static 'images/og-image.jpg' %}">
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Course",
  "name": "{{ program.name|escapejs }}",
  "description": "{{ program.description|escapejs }}",
  "provider": {
    "@type": "CollegeOrUniversity",
    "name": "Melchisedec International University",
    "url": "{{ request.scheme }}://{{ request.get_host }}"
  },
  "educationalLevel": "{{ program.get_degree_level_display }}",
  "timeRequired": "P{{ program.duration_years }}Y"
}
</script>
{% endblock %}

{% block extra_css %}
<style>
  /* Dynamic badge classes — driven by Django template vars, must stay */
  .badge-certificate   { background:#fef3c7; color:#92400e; }
  .badge-diploma       { background:#dbeafe; color:#1e40af; }
  .badge-undergraduate { background:#d1fae5; color:#065f46; }
  .badge-postgraduate  { background:#ede9fe; color:#5b21b6; }
  .badge-masters       { background:#fce7f3; color:#9d174d; }
  .badge-phd           { background:#fee2e2; color:#991b1b; }

  .ctype-core         { background:#d1fae5; color:#065f46; }
  .ctype-elective     { background:#ede9fe; color:#5b21b6; }
  .ctype-general      { background:#fef3c7; color:#92400e; }
  .ctype-prerequisite { background:#fee2e2; color:#991b1b; }

  .intake-january   { background:#dbeafe; color:#1e40af; }
  .intake-may       { background:#d1fae5; color:#065f46; }
  .intake-september { background:#fef3c7; color:#92400e; }

  /* Accordion max-height — not expressible as static Tailwind */
  .yr-acc-content               { max-height:0; overflow:hidden; transition:max-height .42s cubic-bezier(.4,0,.2,1); }
  .yr-acc-content.open          { max-height:99999px; }
  .yr-acc-chevron               { transition:transform .3s ease; }
  .yr-acc-toggle.open .yr-acc-chevron { transform:rotate(180deg); }

  .sem-acc-content              { max-height:0; overflow:hidden; transition:max-height .35s cubic-bezier(.4,0,.2,1); }
  .sem-acc-content.open         { max-height:99999px; }
  .sem-acc-chevron              { transition:transform .3s ease; }
  .sem-acc-toggle.open .sem-acc-chevron { transform:rotate(180deg); }

  /* Semester left-border colour indicator */
  .sem-first  { border-left-color:#6366f1; }
  .sem-second { border-left-color:#a855f7; }
  .sem-annual { border-left-color:#f59e0b; }

  /* Section entrance */
  .reveal-up { animation:revUp .28s ease both; }
  @keyframes revUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }
</style>
{% endblock %}

{% block content %}
<main id="main-content">

  <!-- ══════════════════════════════════════════════════
       HERO
  ══════════════════════════════════════════════════ -->
  <section class="relative bg-gradient-to-br from-primary-950 via-primary-900 to-purple-900 text-white overflow-hidden"
           role="banner" aria-labelledby="program-heading">

    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <div class="absolute -top-24 -left-24 w-96 h-96 bg-purple-500 rounded-full blur-3xl opacity-20"></div>
      <div class="absolute bottom-0 right-0 w-[480px] h-[480px] bg-primary-800 rounded-full blur-3xl opacity-25"></div>
      <div class="absolute top-1/3 left-1/2 w-[400px] h-[400px] bg-purple-700 rounded-full blur-3xl opacity-10"></div>
    </div>

    {% if program.hero_image %}
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <img src="{{ program.hero_image.url }}" alt="" class="w-full h-full object-cover opacity-10" loading="eager">
    </div>
    {% endif %}

    <div class="container mx-auto relative z-10 pt-32 pb-20 lg:pt-40 lg:pb-28 px-4 lg:px-6">

      <!-- Breadcrumb -->
      <nav aria-label="Breadcrumb" class="mb-8">
        <ol class="flex flex-wrap items-center gap-1.5 text-sm font-['Inter']"
            itemscope itemtype="https://schema.org/BreadcrumbList">
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="{% url 'eduweb:index' %}" itemprop="item"
               class="text-purple-300 hover:text-white transition-colors focus:outline-none focus:underline">
              <span itemprop="name">Home</span></a>
            <meta itemprop="position" content="1">
          </li>
          <li aria-hidden="true"><i data-lucide="chevron-right" class="w-3.5 h-3.5 text-purple-500 inline-block align-middle"></i></li>
          {% if faculty %}
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="{% url 'eduweb:faculty_detail' faculty.slug %}" itemprop="item"
               class="text-purple-300 hover:text-white transition-colors focus:outline-none focus:underline">
              <span itemprop="name">{{ faculty.name }}</span></a>
            <meta itemprop="position" content="2">
          </li>
          <li aria-hidden="true"><i data-lucide="chevron-right" class="w-3.5 h-3.5 text-purple-500 inline-block align-middle"></i></li>
          {% endif %}
          {% if department %}
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name" class="text-purple-300">{{ department.name }}</span>
            <meta itemprop="position" content="3">
          </li>
          <li aria-hidden="true"><i data-lucide="chevron-right" class="w-3.5 h-3.5 text-purple-500 inline-block align-middle"></i></li>
          {% endif %}
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name" class="text-white font-medium">{{ program.name }}</span>
            <meta itemprop="position" content="4">
          </li>
        </ol>
      </nav>

      <!-- Program identity -->
      <div class="flex flex-col sm:flex-row items-start gap-5 mb-6">
        <div class="w-16 h-16 lg:w-20 lg:h-20 rounded-2xl flex-shrink-0 flex items-center justify-center"
             style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);" aria-hidden="true">
          <i data-lucide="graduation-cap" class="w-8 h-8 lg:w-10 lg:h-10 text-white"></i>
        </div>
        <div class="flex-1">
          <p class="text-purple-300 text-xs font-semibold mb-2 flex flex-wrap items-center gap-1.5 font-['Inter']">
            {% if faculty %}<span>{{ faculty.name }}</span><i data-lucide="chevron-right" class="w-3 h-3 inline-block" aria-hidden="true"></i>{% endif %}
            {% if department %}<span>{{ department.name }}</span>{% endif %}
          </p>
          <h1 id="program-heading" class="font-['Poppins'] text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight text-white">
            {{ program.name }}
          </h1>
          <div class="flex flex-wrap gap-2 mt-4">
            <span class="px-3 py-1 text-xs font-bold uppercase tracking-wide rounded-full badge-{{ program.degree_level }} font-['Inter']">
              {{ program.get_degree_level_display }}
            </span>
            <span class="px-3 py-1 text-xs font-bold uppercase tracking-widest rounded-full font-['Inter']"
                  style="background:rgba(255,255,255,0.12);color:rgba(255,255,255,0.85);border:1px solid rgba(255,255,255,0.15);">
              {{ program.code }}
            </span>
          </div>
        </div>
      </div>

      {% if program.tagline %}
      <p class="text-purple-300 text-sm font-semibold mb-3 font-['Inter'] italic">{{ program.tagline }}</p>
      {% endif %}

      {% if program.description %}
      <p class="text-base lg:text-lg text-purple-100 leading-relaxed max-w-3xl mb-10 font-['Inter']">
        {{ program.description|truncatewords:60 }}
      </p>
      {% endif %}

      <div class="flex flex-wrap gap-3">
        <a href="{% url 'eduweb:apply' %}"
           class="inline-flex items-center gap-2 px-6 py-3 bg-white text-primary-950 rounded-xl font-semibold text-sm hover:bg-purple-50 hover:scale-105 transition-all duration-300 shadow-xl shadow-black/20 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950 font-['Inter']">
          Apply Now <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
        </a>
        <a href="#courses"
           class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-sm text-white transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950 font-['Inter']"
           style="border:1.5px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.08);">
          View Curriculum <i data-lucide="book-open" class="w-4 h-4" aria-hidden="true"></i>
        </a>
      </div>

    </div>
  </section>

  <!-- ══════════════════════════════════════════════════
       STATS BAR
  ══════════════════════════════════════════════════ -->
  <section class="bg-white border-b border-gray-100" aria-label="Program at a glance">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="grid grid-cols-2 lg:grid-cols-4 divide-x divide-gray-100">
        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">
            {{ program.duration_years }}<span class="text-xl"> yr{% if program.duration_years != 1 %}s{% endif %}</span>
          </p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Duration</p>
        </div>
        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">{{ program.credits_required }}</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Credits Required</p>
        </div>
        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">{{ courses|length }}</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Total Courses</p>
        </div>
        {% if program.job_placement_rate %}
        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">{{ program.job_placement_rate }}%</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Placement Rate</p>
        </div>
        {% elif program.tuition_fee %}
        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">${{ program.tuition_fee|floatformat:0 }}</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Tuition / Year</p>
        </div>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- ══════════════════════════════════════════════════
       OVERVIEW + ENTRY REQUIREMENTS  (combined two-col)
  ══════════════════════════════════════════════════ -->
  {% if program.description or program.entry_requirements %}
  <section class="py-16 lg:py-20 bg-white" aria-labelledby="overview-heading">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="grid lg:grid-cols-2 gap-10 lg:gap-16 items-start">

        <!-- Left: overview -->
        {% if program.description %}
        <div>
          <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">About This Program</p>
          <h2 id="overview-heading" class="font-['Poppins'] text-2xl lg:text-3xl font-bold text-gray-900 mb-4">Program Overview</h2>
          <div class="w-12 h-0.5 bg-gradient-to-r from-primary-600 to-purple-400 mb-6" aria-hidden="true"></div>
          <p class="text-gray-600 leading-relaxed text-sm lg:text-base font-['Inter']">{{ program.description }}</p>

          {% if program.specialization_tracks %}
          <div class="mt-8">
            <p class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-3 font-['Inter']">Specialization Tracks</p>
            <div class="flex flex-wrap gap-2">
              {% for track in program.specialization_tracks %}
              <div class="flex items-center gap-2 px-3 py-2 bg-purple-50 border border-purple-100 rounded-xl">
                <i data-lucide="git-branch" class="w-3.5 h-3.5 text-purple-500 flex-shrink-0" aria-hidden="true"></i>
                <span class="font-['Inter'] text-xs font-semibold text-purple-800">{{ track }}</span>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}

        <!-- Right: entry requirements -->
        {% if program.entry_requirements %}
        <div>
          <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Admissions</p>
          <h2 id="req-heading" class="font-['Poppins'] text-2xl lg:text-3xl font-bold text-gray-900 mb-4">Entry Requirements</h2>
          <div class="w-12 h-0.5 bg-gradient-to-r from-primary-600 to-purple-400 mb-6" aria-hidden="true"></div>
          <div class="bg-gray-50 rounded-2xl border border-gray-100 p-6">
            <ul class="space-y-3" role="list">
              {% for req in program.entry_requirements %}
              <li class="flex items-start gap-3">
                <div class="w-5 h-5 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0 mt-0.5" aria-hidden="true">
                  <i data-lucide="check" class="w-3 h-3 text-primary-700"></i>
                </div>
                <span class="text-gray-700 text-sm font-['Inter']">{{ req }}</span>
              </li>
              {% endfor %}
            </ul>
            <div class="mt-6 pt-5 border-t border-gray-200">
              <a href="{% url 'eduweb:admission_requirement' %}"
                 class="inline-flex items-center gap-2 text-sm font-semibold text-primary-700 hover:text-primary-900 transition-colors focus:outline-none focus:underline font-['Inter']">
                View Full Admission Requirements
                <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
              </a>
            </div>
          </div>
        </div>
        {% endif %}

      </div>
    </div>
  </section>
  {% endif %}

  <!-- ══════════════════════════════════════════════════
       LEARNING OUTCOMES + CAREER PATHS  (two-col)
  ══════════════════════════════════════════════════ -->
  {% if program.learning_outcomes or program.career_paths %}
  <section class="py-16 lg:py-20 bg-gray-50 border-y border-gray-100" aria-labelledby="outcomes-heading">
    <div class="container mx-auto px-4 lg:px-6">
      <h2 id="outcomes-heading" class="sr-only">Outcomes and Careers</h2>
      <div class="grid md:grid-cols-2 gap-8 lg:gap-14">

        {% if program.learning_outcomes %}
        <div>
          <div class="flex items-center gap-2 mb-2">
            <span class="w-5 h-0.5 bg-primary-600 rounded-full"></span>
            <p class="text-primary-700 text-xs font-bold uppercase tracking-widest font-['Inter']">What You'll Learn</p>
          </div>
          <h3 class="font-['Poppins'] text-2xl font-bold text-gray-900 mb-6">Learning Outcomes</h3>
          <ul class="space-y-3" role="list">
            {% for outcome in program.learning_outcomes %}
            <li class="flex items-start gap-3 group">
              <div class="w-6 h-6 rounded-full bg-primary-100 group-hover:bg-primary-200 flex items-center justify-center flex-shrink-0 mt-0.5 transition-colors" aria-hidden="true">
                <i data-lucide="check" class="w-3 h-3 text-primary-700"></i>
              </div>
              <span class="text-gray-700 text-sm font-['Inter'] leading-relaxed">{{ outcome }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        {% if program.career_paths %}
        <div>
          <div class="flex items-center gap-2 mb-2">
            <span class="w-5 h-0.5 bg-purple-500 rounded-full"></span>
            <p class="text-purple-700 text-xs font-bold uppercase tracking-widest font-['Inter']">Where You'll Go</p>
          </div>
          <h3 class="font-['Poppins'] text-2xl font-bold text-gray-900 mb-6">Career Paths</h3>
          {% if program.avg_starting_salary %}
          <div class="flex items-center gap-2 mb-5 p-3.5 bg-purple-50 rounded-xl border border-purple-100">
            <i data-lucide="trending-up" class="w-4 h-4 text-purple-600 flex-shrink-0" aria-hidden="true"></i>
            <p class="text-sm font-['Inter']">
              <span class="font-bold text-purple-800">Avg. Starting Salary: </span>
              <span class="text-purple-700">{{ program.avg_starting_salary }}</span>
            </p>
          </div>
          {% endif %}
          <ul class="space-y-3" role="list">
            {% for path in program.career_paths %}
            <li class="flex items-start gap-3 group">
              <div class="w-6 h-6 rounded-full bg-purple-100 group-hover:bg-purple-200 flex items-center justify-center flex-shrink-0 mt-0.5 transition-colors" aria-hidden="true">
                <i data-lucide="briefcase" class="w-3 h-3 text-purple-700"></i>
              </div>
              <span class="text-gray-700 text-sm font-['Inter'] leading-relaxed">{{ path }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

      </div>
    </div>
  </section>
  {% endif %}

  <!-- ══════════════════════════════════════════════════
       INTAKE SESSIONS
  ══════════════════════════════════════════════════ -->
  {% if active_intakes %}
  <section class="py-16 bg-white" aria-labelledby="intakes-heading">
    <div class="container mx-auto px-4 lg:px-6">

      <div class="flex flex-col lg:flex-row lg:items-end justify-between gap-4 mb-10">
        <div>
          <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Enrolment Windows</p>
          <h2 id="intakes-heading" class="font-['Poppins'] text-2xl lg:text-3xl font-bold text-gray-900">Available Intake Sessions</h2>
        </div>
        <p class="text-gray-500 text-sm font-['Inter'] max-w-xs text-right hidden lg:block">Choose an intake period that works for you and apply before the deadline.</p>
      </div>

      {% regroup active_intakes by year as intake_year_groups %}
      {% for year_group in intake_year_groups %}
      <div class="mb-8 last:mb-0">
        <div class="flex items-center gap-3 mb-4">
          <span class="font-['Poppins'] text-base font-bold text-gray-700">{{ year_group.grouper }}</span>
          <div class="flex-1 h-px bg-gray-100"></div>
        </div>
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for intake in year_group.list %}
          <div class="bg-white rounded-2xl border border-gray-200 p-5 flex flex-col gap-3 hover:border-purple-300 hover:shadow-md transition-all duration-200">
            <div class="flex items-center justify-between">
              <span class="text-xs font-bold uppercase tracking-wide px-2.5 py-1 rounded-full intake-{{ intake.intake_period }} font-['Inter']">
                {{ intake.get_intake_period_display }}
              </span>
              {% if intake.is_active %}
              <span class="flex items-center gap-1 text-xs text-green-600 font-semibold font-['Inter']">
                <span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span>Open
              </span>
              {% else %}
              <span class="flex items-center gap-1 text-xs text-gray-400 font-semibold font-['Inter']">
                <span class="w-1.5 h-1.5 bg-gray-300 rounded-full"></span>Closed
              </span>
              {% endif %}
            </div>
            <div class="space-y-1.5 text-xs font-['Inter']">
              <div class="flex items-center gap-2 text-gray-600">
                <i data-lucide="calendar-days" class="w-3.5 h-3.5 text-primary-400 flex-shrink-0" aria-hidden="true"></i>
                <span>Starts: <strong class="text-gray-800">{{ intake.start_date|date:"d M Y" }}</strong></span>
              </div>
              <div class="flex items-center gap-2 text-gray-600">
                <i data-lucide="calendar-clock" class="w-3.5 h-3.5 text-amber-400 flex-shrink-0" aria-hidden="true"></i>
                <span>Deadline: <strong class="text-gray-800">{{ intake.application_deadline|date:"d M Y" }}</strong></span>
              </div>
              {% if intake.available_slots %}
              <div class="flex items-center gap-2 text-gray-600">
                <i data-lucide="users" class="w-3.5 h-3.5 text-purple-400 flex-shrink-0" aria-hidden="true"></i>
                <span>Slots: <strong class="text-gray-800">{{ intake.available_slots }}</strong> available</span>
              </div>
              {% endif %}
            </div>
            {% if intake.is_active %}
            <a href="{% url 'eduweb:apply' %}"
               class="mt-auto inline-flex items-center justify-center gap-1.5 w-full px-3 py-2.5 rounded-xl text-xs font-semibold bg-primary-950 text-white hover:bg-primary-800 transition-colors font-['Inter'] focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-1">
              Apply for This Intake <i data-lucide="arrow-right" class="w-3 h-3" aria-hidden="true"></i>
            </a>
            {% else %}
            <span class="mt-auto inline-flex items-center justify-center w-full px-3 py-2.5 rounded-xl text-xs font-medium bg-gray-100 text-gray-400 cursor-not-allowed font-['Inter']">
              Applications Closed
            </span>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}

    </div>
  </section>
  {% endif %}

  <!-- ══════════════════════════════════════════════════
       CURRICULUM  –  Full-width Year/Semester Accordions
  ══════════════════════════════════════════════════ -->
  <section id="courses" class="py-16 lg:py-24 bg-gray-50" aria-labelledby="courses-heading">
    <div class="container mx-auto px-4 lg:px-6">

      <!-- Header -->
      <div class="flex flex-col lg:flex-row lg:items-end justify-between gap-4 mb-10 lg:mb-14">
        <div>
          <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Curriculum</p>
          <h2 id="courses-heading" class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-gray-900 mb-2">
            Course Outline
          </h2>
          <p class="text-gray-500 text-sm font-['Inter'] max-w-xl">
            The complete curriculum for <strong class="text-gray-700">{{ program.name }}</strong>, organised by year and semester. Expand each semester to see its courses.
          </p>
        </div>
        <div class="flex items-center gap-3 flex-shrink-0">
          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-200 rounded-xl text-xs font-semibold text-gray-600 font-['Inter']">
            <i data-lucide="book-open" class="w-3.5 h-3.5 text-primary-500" aria-hidden="true"></i>
            {{ courses|length }} course{% if courses|length != 1 %}s{% endif %}
          </span>
          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-200 rounded-xl text-xs font-semibold text-gray-600 font-['Inter']">
            <i data-lucide="award" class="w-3.5 h-3.5 text-primary-500" aria-hidden="true"></i>
            {{ program.credits_required }} credits
          </span>
        </div>
      </div>

      {% if courses %}

      <!-- Legend -->
      <div class="flex flex-wrap gap-3 mb-8 p-4 bg-white rounded-2xl border border-gray-100">
        <span class="text-xs font-bold text-gray-400 uppercase tracking-widest font-['Inter'] mr-1 self-center">Type:</span>
        <span class="inline-flex items-center gap-1.5 text-xs font-semibold px-2.5 py-1 rounded-full font-['Inter'] ctype-core">
          <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>Core
        </span>
        <span class="inline-flex items-center gap-1.5 text-xs font-semibold px-2.5 py-1 rounded-full font-['Inter'] ctype-elective">
          <span class="w-1.5 h-1.5 rounded-full bg-purple-500"></span>Elective
        </span>
        <span class="inline-flex items-center gap-1.5 text-xs font-semibold px-2.5 py-1 rounded-full font-['Inter'] ctype-general">
          <span class="w-1.5 h-1.5 rounded-full bg-amber-500"></span>General
        </span>
        <span class="inline-flex items-center gap-1.5 text-xs font-semibold px-2.5 py-1 rounded-full font-['Inter'] ctype-prerequisite">
          <span class="w-1.5 h-1.5 rounded-full bg-red-400"></span>Prerequisite
        </span>
        <div class="ml-auto flex gap-2">
          <button id="expandAllBtn"
            class="text-xs font-semibold text-primary-700 hover:text-primary-900 font-['Inter'] flex items-center gap-1 transition-colors focus:outline-none">
            <i data-lucide="chevrons-down" class="w-3.5 h-3.5"></i> Expand All
          </button>
          <span class="text-gray-200">|</span>
          <button id="collapseAllBtn"
            class="text-xs font-semibold text-gray-400 hover:text-gray-600 font-['Inter'] flex items-center gap-1 transition-colors focus:outline-none">
            <i data-lucide="chevrons-up" class="w-3.5 h-3.5"></i> Collapse All
          </button>
        </div>
      </div>

      <!-- Year/Semester Accordion tree -->
      {% regroup courses by year_of_study as year_groups %}

      <div class="space-y-4" id="curriculumTree">
        {% for year_group in year_groups %}

        {# ── Year accordion ── #}
        <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm year-block">

          <!-- Year toggle -->
          <button
            class="yr-acc-toggle w-full flex items-center justify-between px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-inset open"
            data-target="yr-body-{{ year_group.grouper }}"
            aria-expanded="true">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 rounded-xl bg-primary-600 flex items-center justify-center flex-shrink-0" aria-hidden="true">
                <span class="font-['Poppins'] font-bold text-white text-sm">Y{{ year_group.grouper }}</span>
              </div>
              <div>
                <h3 class="font-['Poppins'] text-base font-bold text-gray-900">Year {{ year_group.grouper }}</h3>
                <p class="text-xs text-gray-400 font-['Inter'] mt-0.5">{{ year_group.list|length }} course{% if year_group.list|length != 1 %}s{% endif %}</p>
              </div>
            </div>
            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 yr-acc-chevron flex-shrink-0" aria-hidden="true"></i>
          </button>

          <!-- Year body -->
          <div id="yr-body-{{ year_group.grouper }}" class="yr-acc-content open">

            {% regroup year_group.list by semester as semester_groups %}

            <div class="divide-y divide-gray-100">
              {% for semester_group in semester_groups %}

              {# ── Semester accordion ── #}
              <div class="sem-block">

                <!-- Semester toggle -->
                <button
                  class="sem-acc-toggle w-full flex items-center justify-between px-6 py-3.5 bg-gray-50 hover:bg-purple-50/60 text-left transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-inset border-l-4 sem-{{ semester_group.grouper }} open"
                  data-target="sem-body-{{ year_group.grouper }}-{{ semester_group.grouper }}"
                  aria-expanded="true">
                  <div class="flex items-center gap-3">
                    <span class="font-['Inter'] text-sm font-bold text-gray-700">
                      {{ semester_group.list.0.get_semester_display }}
                    </span>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 text-[10px] font-bold font-['Inter']">
                      {{ semester_group.list|length }}
                    </span>
                    {# Credit total per semester #}
                    <span class="text-xs text-gray-400 font-['Inter'] hidden sm:inline">
                      {% with total=0 %}
                        {% for c in semester_group.list %}{{ c.credit_units }}{% if not forloop.last %}+{% endif %}{% endfor %} credits
                      {% endwith %}
                    </span>
                  </div>
                  <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400 sem-acc-chevron flex-shrink-0" aria-hidden="true"></i>
                </button>

                <!-- Semester course table -->
                <div id="sem-body-{{ year_group.grouper }}-{{ semester_group.grouper }}" class="sem-acc-content open">
                  <div class="divide-y divide-gray-50">

                    {# Table header — desktop only #}
                    <div class="hidden sm:grid grid-cols-12 px-6 py-2 bg-white border-b border-gray-100" aria-hidden="true">
                      <div class="col-span-1"></div>
                      <div class="col-span-4 text-[10px] font-bold uppercase tracking-widest text-gray-300 font-['Inter']">Course</div>
                      <div class="col-span-2 text-[10px] font-bold uppercase tracking-widest text-gray-300 font-['Inter']">Code</div>
                      <div class="col-span-2 text-[10px] font-bold uppercase tracking-widest text-gray-300 font-['Inter']">Type</div>
                      <div class="col-span-1 text-[10px] font-bold uppercase tracking-widest text-gray-300 font-['Inter'] text-center">Credits</div>
                      <div class="col-span-2 text-[10px] font-bold uppercase tracking-widest text-gray-300 font-['Inter']">Lecturer</div>
                    </div>

                    {% for course in semester_group.list %}
                    <div class="group px-6 py-4 hover:bg-purple-50/50 transition-colors duration-150 sm:grid sm:grid-cols-12 sm:items-center flex flex-col gap-3"
                         aria-label="{{ course.name }}">

                      {# Icon col #}
                      <div class="sm:col-span-1">
                        <div class="w-9 h-9 rounded-xl bg-primary-50 group-hover:bg-primary-100 flex items-center justify-center transition-colors" aria-hidden="true">
                          <i data-lucide="{{ course.icon|default:'book-open' }}" class="w-4 h-4 text-primary-700"></i>
                        </div>
                      </div>

                      {# Name + description col #}
                      <div class="sm:col-span-4 min-w-0 pr-2">
                        <h4 class="font-['Poppins'] text-sm font-bold text-gray-900 leading-snug">{{ course.name }}</h4>
                        {% if course.description %}
                        <p class="text-xs text-gray-400 font-['Inter'] mt-0.5 line-clamp-1">{{ course.description }}</p>
                        {% endif %}
                      </div>

                      {# Code col #}
                      <div class="sm:col-span-2">
                        <span class="text-xs font-mono text-gray-500 bg-gray-100 px-2 py-0.5 rounded-lg">{{ course.code }}</span>
                      </div>

                      {# Type badge col #}
                      <div class="sm:col-span-2">
                        <span class="text-[10px] font-bold uppercase px-2 py-0.5 rounded font-['Inter'] ctype-{{ course.course_type }}">
                          {{ course.get_course_type_display }}
                        </span>
                      </div>

                      {# Credits col #}
                      <div class="sm:col-span-1 text-center">
                        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-primary-50 text-primary-700 text-xs font-bold font-['Inter']" aria-label="{{ course.credit_units }} credits">
                          {{ course.credit_units }}
                        </span>
                      </div>

                      {# Lecturer col #}
                      <div class="sm:col-span-2">
                        {% if course.lecturer %}
                        <div class="flex items-center gap-1.5">
                          <div class="w-5 h-5 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0" aria-hidden="true">
                            <i data-lucide="user" class="w-2.5 h-2.5 text-purple-600"></i>
                          </div>
                          <span class="text-xs text-gray-500 font-['Inter'] truncate">{{ course.lecturer.get_full_name|default:course.lecturer.username }}</span>
                        </div>
                        {% else %}
                        <span class="text-xs text-gray-300 font-['Inter']">—</span>
                        {% endif %}
                      </div>

                    </div>
                    {% endfor %}

                    {# Semester credit subtotal footer #}
                    <div class="px-6 py-3 bg-gray-50/80 flex items-center justify-end gap-2">
                      <span class="text-xs text-gray-400 font-['Inter']">Semester total:</span>
                      <span class="text-xs font-bold text-primary-700 font-['Inter']">
                        {% for c in semester_group.list %}{% if not forloop.first %}+{% endif %}{{ c.credit_units }}{% endfor %} credits
                      </span>
                    </div>

                  </div>
                </div>
              </div>
              {# /semester #}

              {% endfor %}
            </div>

          </div>
        </div>
        {# /year #}

        {% endfor %}
      </div>

      <!-- Summary row -->
      <div class="mt-8 flex flex-wrap items-center justify-between gap-4 pt-6 border-t border-gray-200">
        <p class="text-sm text-gray-500 font-['Inter']">
          <strong class="text-gray-700">{{ courses|length }}</strong> course{% if courses|length != 1 %}s{% endif %} total ·
          <strong class="text-gray-700">{{ program.credits_required }}</strong> credits required to graduate
        </p>
        <a href="{% url 'eduweb:apply' %}"
           class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-semibold bg-primary-950 text-white hover:bg-primary-800 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 font-['Inter']">
          Apply to This Program <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
        </a>
      </div>

      {% else %}
      <div class="flex flex-col items-center justify-center text-center py-20 rounded-2xl border-2 border-dashed border-gray-200 bg-white" role="status">
        <i data-lucide="folder-open" class="w-12 h-12 text-gray-300 mb-3" aria-hidden="true"></i>
        <p class="font-semibold text-gray-400 font-['Poppins']">No courses have been added yet</p>
        <p class="text-sm text-gray-400 mt-1 font-['Inter']">Check back soon, or contact the faculty office for more information.</p>
      </div>
      {% endif %}

    </div>
  </section>

  <!-- ══════════════════════════════════════════════════
       WHY THIS PROGRAM  –  compact horizontal strip
  ══════════════════════════════════════════════════ -->
  <section class="py-16 bg-white border-t border-gray-100" aria-labelledby="why-heading">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="flex flex-col lg:flex-row lg:items-start gap-10 lg:gap-16">

        <!-- Left: heading block -->
        <div class="lg:w-64 flex-shrink-0">
          <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Advantages</p>
          <h2 id="why-heading" class="font-['Poppins'] text-2xl lg:text-3xl font-bold text-gray-900">Why Choose<br class="hidden lg:block"> This Program?</h2>
        </div>

        <!-- Right: features grid -->
        <div class="flex-1 grid sm:grid-cols-2 lg:grid-cols-3 gap-4">

          <article class="flex items-start gap-3 p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-2xl border border-gray-100 transition-all duration-200">
            <div class="w-9 h-9 rounded-xl bg-primary-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <i data-lucide="building-2" class="w-4 h-4 text-primary-700"></i>
            </div>
            <div>
              <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-1">Industry Partnerships</h3>
              <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Internships and real-world projects with leading companies.</p>
            </div>
          </article>

          <article class="flex items-start gap-3 p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-2xl border border-gray-100 transition-all duration-200">
            <div class="w-9 h-9 rounded-xl bg-purple-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <i data-lucide="users" class="w-4 h-4 text-purple-600"></i>
            </div>
            <div>
              <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-1">Expert Faculty</h3>
              <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Learn from seasoned professionals and active researchers.</p>
            </div>
          </article>

          <article class="flex items-start gap-3 p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-2xl border border-gray-100 transition-all duration-200">
            <div class="w-9 h-9 rounded-xl bg-amber-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <i data-lucide="hammer" class="w-4 h-4 text-amber-600"></i>
            </div>
            <div>
              <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-1">Hands-On Experience</h3>
              <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Practical projects from your very first semester.</p>
            </div>
          </article>

          <article class="flex items-start gap-3 p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-2xl border border-gray-100 transition-all duration-200">
            <div class="w-9 h-9 rounded-xl bg-primary-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <i data-lucide="globe" class="w-4 h-4 text-primary-700"></i>
            </div>
            <div>
              <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-1">Global Network</h3>
              <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Join a worldwide community of alumni and professionals.</p>
            </div>
          </article>

          <article class="flex items-start gap-3 p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-2xl border border-gray-100 transition-all duration-200">
            <div class="w-9 h-9 rounded-xl bg-purple-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <i data-lucide="cpu" class="w-4 h-4 text-purple-600"></i>
            </div>
            <div>
              <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-1">Modern Facilities</h3>
              <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">State-of-the-art labs and cutting-edge infrastructure.</p>
            </div>
          </article>

          <article class="flex items-start gap-3 p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-2xl border border-gray-100 transition-all duration-200">
            <div class="w-9 h-9 rounded-xl bg-amber-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <i data-lucide="rocket" class="w-4 h-4 text-amber-600"></i>
            </div>
            <div>
              <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-1">Career Services</h3>
              <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Placement support, CV workshops, and employer connections.</p>
            </div>
          </article>

        </div>
      </div>
    </div>
  </section>

  <!-- ══════════════════════════════════════════════════
       CTA BANNER
  ══════════════════════════════════════════════════ -->
  <section class="py-20 bg-gray-50" aria-labelledby="cta-heading">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-5xl mx-auto bg-gradient-to-br from-primary-950 via-primary-900 to-purple-900 rounded-3xl px-8 py-14 lg:px-16 relative overflow-hidden">
        <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
          <div class="absolute -bottom-16 -right-16 w-64 h-64 bg-purple-600 rounded-full blur-3xl opacity-30"></div>
          <div class="absolute top-0 left-0 w-48 h-48 bg-primary-700 rounded-full blur-3xl opacity-20"></div>
        </div>
        <div class="relative z-10 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-8">
          <div class="flex-1">
            <p class="text-purple-300 text-xs font-bold uppercase tracking-widest mb-3 font-['Inter']">Next Steps</p>
            <h2 id="cta-heading" class="font-['Poppins'] text-2xl lg:text-3xl font-bold text-white mb-3">
              Ready to Enrol in {{ program.name }}?
            </h2>
            <p class="text-purple-200 text-sm leading-relaxed max-w-lg font-['Inter']">
              Take the first step. Apply today and our admissions team will guide you through every stage of the process.
            </p>
          </div>
          <div class="flex flex-wrap gap-3 flex-shrink-0">
            <a href="{% url 'eduweb:apply' %}"
               class="inline-flex items-center gap-2 px-6 py-3 bg-white text-primary-950 rounded-xl font-semibold text-sm hover:bg-purple-50 hover:scale-105 transition-all duration-300 shadow-xl shadow-black/20 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950 font-['Inter']">
              Apply Now <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
            </a>
            {% if faculty %}
            <a href="{% url 'eduweb:faculty_detail' faculty.slug %}"
               class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-sm text-white transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950 font-['Inter']"
               style="border:1.5px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.08);">
              Back to Faculty <i data-lucide="arrow-left" class="w-4 h-4" aria-hidden="true"></i>
            </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>

</main>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  lucide.createIcons();

  /* ════════════════════════════════════════
     Year accordion
  ════════════════════════════════════════ */
  document.querySelectorAll('.yr-acc-toggle').forEach(function (btn) {
    btn.addEventListener('click', function () {
      var panel  = document.getElementById(btn.dataset.target);
      var isOpen = btn.classList.contains('open');
      btn.classList.toggle('open', !isOpen);
      if (panel) panel.classList.toggle('open', !isOpen);
      btn.setAttribute('aria-expanded', String(!isOpen));
    });
  });

  /* ════════════════════════════════════════
     Semester accordion
  ════════════════════════════════════════ */
  document.querySelectorAll('.sem-acc-toggle').forEach(function (btn) {
    btn.addEventListener('click', function () {
      var panel  = document.getElementById(btn.dataset.target);
      var isOpen = btn.classList.contains('open');
      btn.classList.toggle('open', !isOpen);
      if (panel) panel.classList.toggle('open', !isOpen);
      btn.setAttribute('aria-expanded', String(!isOpen));
    });
  });

  /* ════════════════════════════════════════
     Expand / Collapse All
  ════════════════════════════════════════ */
  document.getElementById('expandAllBtn') && document.getElementById('expandAllBtn').addEventListener('click', function () {
    document.querySelectorAll('.yr-acc-toggle, .sem-acc-toggle').forEach(function (btn) {
      var panel = document.getElementById(btn.dataset.target);
      btn.classList.add('open');
      if (panel) panel.classList.add('open');
      btn.setAttribute('aria-expanded', 'true');
    });
  });

  document.getElementById('collapseAllBtn') && document.getElementById('collapseAllBtn').addEventListener('click', function () {
    document.querySelectorAll('.yr-acc-toggle, .sem-acc-toggle').forEach(function (btn) {
      var panel = document.getElementById(btn.dataset.target);
      btn.classList.remove('open');
      if (panel) panel.classList.remove('open');
      btn.setAttribute('aria-expanded', 'false');
    });
  });

});
</script>
{% endblock %}