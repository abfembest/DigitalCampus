{% extends 'management/base.html' %}
{% block title %}Transaction {{ transaction.transaction_id }} · Admin{% endblock %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8 py-6 max-w-full mx-auto">

  {# Breadcrumb #}
  <nav aria-label="Breadcrumb"
       class="flex items-center gap-2 text-sm text-gray-500 mb-6">
    <a href="{% url 'management:transactions_list' %}"
       class="hover:text-primary-600 transition inline-flex items-center gap-1">
      <i class="fas fa-arrow-left text-xs" aria-hidden="true"></i>
      Transactions
    </a>
    <i class="fas fa-chevron-right text-xs" aria-hidden="true"></i>
    <span class="text-gray-700 font-mono text-xs">
      {{ transaction.transaction_id }}
    </span>
  </nav>

  <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden">

    {# Gradient header #}
    <div class="px-6 py-5 bg-gradient-to-r from-primary-600 to-primary-700">
      <div class="flex flex-col sm:flex-row sm:items-center
                  sm:justify-between gap-3">
        <div>
          <p class="text-primary-100 text-xs font-semibold uppercase tracking-wide mb-1">
            Transaction ID
          </p>
          <p class="text-white font-mono font-bold text-lg break-all">
            {{ transaction.transaction_id }}
          </p>
        </div>

        {# Status pill #}
        <span class="self-start sm:self-center inline-flex items-center gap-1.5
                     px-3 py-1.5 rounded-full text-sm font-semibold shrink-0
          {% if transaction.status == 'completed' %}
            bg-green-100 text-green-800
          {% elif transaction.status == 'failed' %}
            bg-red-100 text-red-800
          {% elif transaction.status == 'refunded' %}
            bg-purple-100 text-purple-800
          {% elif transaction.status == 'processing' %}
            bg-blue-100 text-blue-800
          {% else %}
            bg-yellow-100 text-yellow-800
          {% endif %}">
          <i class="fas fa-xs
            {% if transaction.status == 'completed' %}fa-circle-check
            {% elif transaction.status == 'failed'  %}fa-circle-xmark
            {% elif transaction.status == 'refunded'%}fa-rotate-left
            {% elif transaction.status == 'processing'%}fa-spinner
            {% else %}fa-clock{% endif %}"
             aria-hidden="true"></i>
          {{ transaction.get_status_display }}
        </span>
      </div>
    </div>

    {# Amount highlight #}
    <div class="py-8 flex items-center justify-center bg-gray-50
                border-b border-gray-100">
      <div class="text-center">
        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
          Amount
        </p>
        <p class="text-5xl font-bold text-gray-900">
          {{ transaction.currency }}
          {{ transaction.amount|floatformat:2 }}
        </p>
      </div>
    </div>

    {# Detail grid #}
    <div class="p-6">
      <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-10 gap-y-5">

        <div>
          <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5">
            User
          </dt>
          <dd class="text-gray-900 font-medium">
            {{ transaction.user.get_full_name|default:transaction.user.username }}
          </dd>
          <dd class="text-xs text-gray-400">@{{ transaction.user.username }}</dd>
        </div>

        <div>
          <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5">
            Payment Gateway
          </dt>
          <dd class="text-gray-900 font-medium">
            {% if transaction.gateway %}
              {{ transaction.gateway.name }}
              <span class="text-xs text-gray-400 ml-1">
                ({{ transaction.gateway.get_gateway_type_display }})
              </span>
            {% else %}
              <span class="text-gray-300">—</span>
            {% endif %}
          </dd>
        </div>

        <div>
          <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5">
            Transaction Type
          </dt>
          <dd class="text-gray-900">{{ transaction.get_transaction_type_display }}</dd>
        </div>

        <div>
          <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5">
            Currency
          </dt>
          <dd class="text-gray-900">{{ transaction.currency }}</dd>
        </div>

        {% if transaction.course %}
        <div>
          <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5">
            Course
          </dt>
          <dd class="text-gray-900 font-medium">{{ transaction.course.title }}</dd>
          <dd class="text-xs text-gray-400 font-mono">{{ transaction.course.code }}</dd>
        </div>
        {% endif %}

        {% if transaction.gateway_transaction_id %}
        <div>
          <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5">
            Gateway Reference
          </dt>
          <dd class="text-gray-700 font-mono text-xs break-all">
            {{ transaction.gateway_transaction_id }}
          </dd>
        </div>
        {% endif %}

        <div>
          <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5">
            Created
          </dt>
          <dd class="text-gray-900">
            <time datetime="{{ transaction.created_at|date:'c' }}">
              {{ transaction.created_at|date:"M d, Y H:i" }}
            </time>
          </dd>
        </div>

        <div>
          <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-0.5">
            Completed
          </dt>
          <dd class="text-gray-900">
            {% if transaction.completed_at %}
              <time datetime="{{ transaction.completed_at|date:'c' }}">
                {{ transaction.completed_at|date:"M d, Y H:i" }}
              </time>
            {% else %}
              <span class="text-gray-300">—</span>
            {% endif %}
          </dd>
        </div>

      </dl>

      {# Metadata block #}
      {% if transaction.metadata %}
      <div class="mt-6 pt-5 border-t border-gray-100">
        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">
          Metadata
        </p>
        <pre class="bg-gray-50 rounded-xl p-4 text-xs text-gray-700
                    overflow-x-auto font-mono border border-gray-200
                    whitespace-pre-wrap break-words">{{ transaction.metadata }}</pre>
      </div>
      {% endif %}
    </div>

    {# Footer #}
    <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-end">
      <a href="{% url 'management:transactions_list' %}"
         class="inline-flex items-center gap-2 px-5 py-2.5 border border-gray-300
                rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100
                transition focus:outline-none focus:ring-2 focus:ring-gray-400">
        <i class="fas fa-arrow-left text-xs" aria-hidden="true"></i>
        Back to Transactions
      </a>
    </div>

  </div>
</div>
{% endblock %}