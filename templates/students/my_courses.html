{% extends "management/base.html" %}
{% load static %}

{% block title %}{{ page_title }} - MIU Student Portal{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">My Courses</h1>
        <p class="text-gray-600 mt-2">Track your learning journey</p>
    </div>

    <!-- Filters - Only Active and Completed -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6">
        <div class="flex items-center space-x-4">
            <a href="?status=active" 
               class="px-4 py-2 rounded-lg {% if status_filter == 'active' %}bg-primary-600 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %} transition-all">
                Active
            </a>
            <a href="?status=completed" 
               class="px-4 py-2 rounded-lg {% if status_filter == 'completed' %}bg-primary-600 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %} transition-all">
                Completed
            </a>
            <!-- Removed "All Courses" option -->
        </div>
    </div>

    <!-- Courses List -->
    {% if enrollments %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for enrollment in enrollments %}
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-all">
            <!-- Course Thumbnail -->
            <div class="h-40 bg-gradient-to-br from-primary-500 to-secondary-500 relative">
                {% if enrollment.course.thumbnail %}
                <img src="{{ enrollment.course.thumbnail.url }}" 
                     alt="{{ enrollment.course.title }}" 
                     class="w-full h-full object-cover">
                {% else %}
                <div class="w-full h-full flex items-center justify-center">
                    <i class="fas fa-book text-white text-5xl opacity-50"></i>
                </div>
                {% endif %}
                
                <!-- Status Badge -->
                <div class="absolute top-3 right-3">
                    {% if enrollment.status == 'completed' %}
                    <span class="px-3 py-1 bg-green-500 text-white rounded-full text-xs font-semibold">
                        <i class="fas fa-check mr-1"></i> Completed
                    </span>
                    {% elif enrollment.status == 'active' %}
                    <span class="px-3 py-1 bg-blue-500 text-white rounded-full text-xs font-semibold">
                        In Progress
                    </span>
                    {% endif %}
                </div>
            </div>

            <div class="p-6">
                <!-- Category -->
                {% if enrollment.course.category %}
                <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium mb-3 inline-block">
                    {{ enrollment.course.category.name }}
                </span>
                {% endif %}

                <!-- Course Title -->
                <h3 class="text-lg font-bold text-gray-900 mb-2 line-clamp-2">
                    <a href="{% url 'students:course_detail' enrollment.course.id %}" 
                       class="hover:text-primary-600">
                        {{ enrollment.course.title }}
                    </a>
                </h3>

                <!-- Instructor -->
                <p class="text-sm text-gray-600 mb-4">
                    <i class="fas fa-user-tie mr-1"></i>
                    {{ enrollment.course.instructor_name }}
                </p>

                <!-- Progress -->
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-600">Progress</span>
                        <span class="font-semibold text-gray-900">{{ enrollment.progress_percentage|floatformat:0 }}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="{% if enrollment.progress_percentage == 100 %}bg-green-500{% else %}bg-primary-600{% endif %} h-2.5 rounded-full" 
                             style="width: {{ enrollment.progress_percentage }}%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">
                        {{ enrollment.completed_lessons }} of {{ enrollment.course.lessons.count }} lessons
                    </p>
                </div>

                <!-- Enrollment Info -->
                <div class="text-xs text-gray-500 mb-4 pb-4 border-b border-gray-200">
                    <i class="fas fa-calendar mr-1"></i>
                    Enrolled: {{ enrollment.enrolled_at|date:"M d, Y" }}
                    {% if enrollment.last_accessed %}
                    <br>
                    <i class="fas fa-clock mr-1"></i>
                    Last accessed: {{ enrollment.last_accessed|date:"M d, Y" }}
                    {% endif %}
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-2">
                    <a href="{% url 'students:course_detail' enrollment.course.id %}" 
                       class="flex-1 text-center px-4 py-2.5 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-all font-medium text-sm">
                        {% if enrollment.status == 'completed' %}
                            Review
                        {% else %}
                            Continue
                        {% endif %}
                    </a>
                    {% if enrollment.status == 'completed' and enrollment.course.has_certificate %}
                    <a href="{% url 'students:certificates' %}" 
                       class="px-4 py-2.5 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-all text-sm">
                        <i class="fas fa-certificate"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-12">
        <div class="text-center">
            <i class="fas fa-book-open text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">No courses found</h3>
            <p class="text-gray-600 mb-6">
                {% if status_filter == 'active' %}
                You don't have any active courses
                {% elif status_filter == 'completed' %}
                You haven't completed any courses yet
                {% endif %}
            </p>
            <a href="{% url 'students:course_catalog' %}" 
               class="inline-block px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-all font-semibold">
                Browse Course Catalog
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}