{% extends 'management/base.html' %}
{% load static %}

{% block title %}{% if session %}Edit{% else %}New{% endif %} Academic Session - MIU Admin Portal{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">

  <nav class="flex items-center gap-2 text-sm text-gray-500 mb-6" aria-label="Breadcrumb">
    <a href="{% url 'management:academic_sessions_list' %}" class="hover:text-primary-600">Academic Sessions</a>
    <i class="fas fa-chevron-right text-xs" aria-hidden="true"></i>
    <span class="text-gray-800 font-medium">{% if session %}Edit: {{ session.name }}{% else %}New Session{% endif %}</span>
  </nav>

  <form method="post" class="space-y-6">
    {% csrf_token %}

    {% if form.non_field_errors %}
    <div class="p-4 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700">
      {% for error in form.non_field_errors %}{{ error }}{% endfor %}
    </div>
    {% endif %}

    <!-- Identity -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-100">
        <h2 class="font-semibold text-gray-800"><i class="fas fa-calendar text-primary-500 mr-2" aria-hidden="true"></i>Session Identity</h2>
      </div>
      <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-5">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1.5">Session Name <span class="text-red-500">*</span></label>
          <input type="text" name="{{ form.name.html_name }}" value="{{ form.name.value|default:'' }}"
                 placeholder="e.g., 2024/2025"
                 class="w-full px-4 py-2.5 border {% if form.name.errors %}border-red-400{% else %}border-gray-300{% endif %} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
          {% if form.name.errors %}<p class="text-xs text-red-500 mt-1">{{ form.name.errors.0 }}</p>{% endif %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1.5">Status</label>
          <select name="{{ form.status.html_name }}"
                  class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
            {% for val, label in form.status.field.choices %}
            <option value="{{ val }}" {% if form.status.value == val %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>

    <!-- Semester 1 -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 bg-blue-50 border-b border-gray-100">
        <h2 class="font-semibold text-gray-800"><i class="fas fa-calendar-week text-blue-500 mr-2" aria-hidden="true"></i>First Semester</h2>
      </div>
      <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-5">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1.5">Start Date <span class="text-red-500">*</span></label>
          <input type="date" name="{{ form.first_semester_start.html_name }}" value="{{ form.first_semester_start.value|default:'' }}"
                 class="w-full px-4 py-2.5 border {% if form.first_semester_start.errors %}border-red-400{% else %}border-gray-300{% endif %} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
          {% if form.first_semester_start.errors %}<p class="text-xs text-red-500 mt-1">{{ form.first_semester_start.errors.0 }}</p>{% endif %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1.5">End Date <span class="text-red-500">*</span></label>
          <input type="date" name="{{ form.first_semester_end.html_name }}" value="{{ form.first_semester_end.value|default:'' }}"
                 class="w-full px-4 py-2.5 border {% if form.first_semester_end.errors %}border-red-400{% else %}border-gray-300{% endif %} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
          {% if form.first_semester_end.errors %}<p class="text-xs text-red-500 mt-1">{{ form.first_semester_end.errors.0 }}</p>{% endif %}
        </div>
      </div>
    </div>

    <!-- Semester 2 -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 bg-green-50 border-b border-gray-100">
        <h2 class="font-semibold text-gray-800"><i class="fas fa-calendar-week text-green-500 mr-2" aria-hidden="true"></i>Second Semester</h2>
      </div>
      <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-5">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1.5">Start Date <span class="text-red-500">*</span></label>
          <input type="date" name="{{ form.second_semester_start.html_name }}" value="{{ form.second_semester_start.value|default:'' }}"
                 class="w-full px-4 py-2.5 border {% if form.second_semester_start.errors %}border-red-400{% else %}border-gray-300{% endif %} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1.5">End Date <span class="text-red-500">*</span></label>
          <input type="date" name="{{ form.second_semester_end.html_name }}" value="{{ form.second_semester_end.value|default:'' }}"
                 class="w-full px-4 py-2.5 border {% if form.second_semester_end.errors %}border-red-400{% else %}border-gray-300{% endif %} rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
        </div>
      </div>
    </div>

    <!-- Registration Window -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-100">
        <h2 class="font-semibold text-gray-800"><i class="fas fa-door-open text-yellow-500 mr-2" aria-hidden="true"></i>Registration Window <span class="text-sm font-normal text-gray-400">(optional)</span></h2>
      </div>
      <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-5">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1.5">Registration Opens</label>
          <input type="date" name="{{ form.registration_start.html_name }}" value="{{ form.registration_start.value|default:'' }}"
                 class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1.5">Registration Closes</label>
          <input type="date" name="{{ form.registration_end.html_name }}" value="{{ form.registration_end.value|default:'' }}"
                 class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
        </div>
      </div>
    </div>

    <!-- Mark as Current -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
      <label class="flex items-start gap-3 cursor-pointer">
        <input type="checkbox" name="{{ form.is_current.html_name }}" {% if form.is_current.value %}checked{% endif %}
               class="mt-0.5 w-4 h-4 rounded text-primary-600 border-gray-300 focus:ring-primary-500">
        <div>
          <span class="text-sm font-medium text-gray-700">Mark as Current Session</span>
          <p class="text-xs text-gray-400 mt-0.5">Only one session can be current at a time. Enabling this will unset the previous current session.</p>
        </div>
      </label>
    </div>

    <!-- Actions -->
    <div class="flex flex-col sm:flex-row justify-end gap-3">
      <a href="{% url 'management:academic_sessions_list' %}"
         class="px-5 py-2.5 border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 text-sm font-medium text-center">Cancel</a>
      <button type="submit"
              class="px-6 py-2.5 bg-primary-600 text-white rounded-lg hover:bg-primary-700 text-sm font-medium shadow-sm">
        <i class="fas fa-save mr-1.5" aria-hidden="true"></i>
        {% if session %}Save Changes{% else %}Create Session{% endif %}
      </button>
    </div>
  </form>
</div>
{% endblock %}