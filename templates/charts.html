{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Modern International University - Empowering global education with flexible online programs, world-class faculty, and innovative learning experiences.">
    <meta name="keywords" content="online university, distance learning, international education, online degrees, MIU">
    <meta name="author" content="Modern International University">

    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="MIU – Modern International University">
    <meta property="og:description" content="Empowering global education with flexible online programs">
    <meta property="og:image" content="{% static 'images/og-image.jpg' %}">

    <title>{% block title %}MIU – Modern International University{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f7ff',
                            100: '#e0effe',
                            200: '#bae0fd',
                            300: '#7dc7fc',
                            400: '#38abf8',
                            500: '#0e8fe9',
                            600: '#0272c7',
                            700: '#035aa1',
                            800: '#074d85',
                            900: '#0c416e',
                            950: '#0F2A44',
                        },
                        accent: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#FACC15',
                            500: '#eab308',
                            600: '#ca8a04',
                            700: '#a16207',
                            800: '#854d0e',
                            900: '#713f12',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        display: ['Poppins', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                    },
                    container: {
                        center: true,
                        padding: {
                            DEFAULT: '1rem',
                            sm: '2rem',
                            lg: '4rem',
                            xl: '6rem',
                            '2xl': '8rem',
                        },
                    },
                }
            }
        }
    </script>

    <style>
        /* Minimal custom styles - only what Tailwind can't handle */
        .gradient-text {
            background: linear-gradient(135deg, #0F2A44 0%, #0272c7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>

<body class="font-sans text-gray-900 bg-gray-50 antialiased">

    <!-- ================= STUDENT LIFE CHATBOT ================= -->
    <!-- Add this HTML at the end of the body, just before closing </body> tag -->
    <div id="studentLifeChatbot" class="fixed bottom-6 right-6 z-50">
        <!-- Chatbot Toggle Button -->
        <button id="chatbotToggle"
                class="w-16 h-16 bg-gradient-miu rounded-full flex items-center justify-center shadow-2xl hover:shadow-3xl transition-all duration-300 hover:scale-110">
            <div id="chatbotIcon" class="text-white text-2xl transition-transform duration-300">💬</div>
            <div id="notificationBadge"
                 class="absolute -top-1 -right-1 w-6 h-6 bg-miu-accent rounded-full flex items-center justify-center text-xs font-bold text-miu-primary hidden">
                3
            </div>
        </button>

        <!-- Chatbot Window -->
        <div id="chatbotWindow"
             class="hidden absolute bottom-20 right-0 w-96 h-[600px] bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-200">
            <!-- Chat Header -->
            <div class="bg-gradient-miu text-white p-4 flex justify-between items-center">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center mr-3">
                        <span class="text-miu-primary font-bold">MIU</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">Student Life Assistant</h3>
                        <div class="flex items-center text-sm">
                            <div class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                            <span>Online</span>
                        </div>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button id="chatbotMinimize" class="text-white hover:text-gray-200 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6"></path>
                        </svg>
                    </button>
                    <button id="chatbotClose" class="text-white hover:text-gray-200 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Chat Body -->
            <div class="h-[calc(100%-140px)] flex flex-col">
                <!-- Messages Container -->
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <!-- Initial Welcome Message -->
                    <div class="chat-message bot-message">
                        <div class="flex items-start space-x-2">
                            <div class="w-8 h-8 bg-gradient-to-r from-miu-primary to-miu-secondary rounded-full flex items-center justify-center text-white text-sm">
                                AI
                            </div>
                            <div>
                                <div class="bg-gray-100 rounded-2xl rounded-tl-none p-4 max-w-[80%]">
                                    <p class="text-gray-800">
                                        👋 Welcome to MIU Student Life Assistant! I'm here to help
                                        you explore campus life, academic support, extracurricular activities, career
                                        services, and wellbeing resources. How can I assist you today?
                                    </p>
                                </div>
                                <div class="text-xs text-gray-500 mt-1 ml-1">Just now</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Action Buttons -->
                    <div class="chat-message bot-message">
                        <div class="flex items-start space-x-2">
                            <div class="w-8 h-8 bg-gradient-to-r from-miu-primary to-miu-secondary rounded-full flex items-center justify-center text-white text-sm">
                                AI
                            </div>
                            <div>
                                <div class="max-w-[80%]">
                                    <p class="text-gray-800 mb-2">Quickly explore popular topics:</p>
                                    <div class="flex flex-wrap gap-2">
                                        <button class="quick-action bg-blue-100 hover:bg-blue-200 text-blue-800 px-3 py-2 rounded-lg text-sm transition-colors"
                                                data-action="academic">
                                            📚 Academic Support
                                        </button>
                                        <button class="quick-action bg-green-100 hover:bg-green-200 text-green-800 px-3 py-2 rounded-lg text-sm transition-colors"
                                                data-action="community">
                                            🌍 Virtual Community
                                        </button>
                                        <button class="quick-action bg-purple-100 hover:bg-purple-200 text-purple-800 px-3 py-2 rounded-lg text-sm transition-colors"
                                                data-action="activities">
                                            🎭 Extracurriculars
                                        </button>
                                        <button class="quick-action bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-3 py-2 rounded-lg text-sm transition-colors"
                                                data-action="career">
                                            💼 Career Services
                                        </button>
                                        <button class="quick-action bg-pink-100 hover:bg-pink-200 text-pink-800 px-3 py-2 rounded-lg text-sm transition-colors"
                                                data-action="wellbeing">
                                            ❤️ Wellbeing Resources
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-4 py-2">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-miu-primary to-miu-secondary rounded-full flex items-center justify-center text-white text-sm">
                            AI
                        </div>
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-gray-300 rounded-full animate-pulse"></div>
                            <div class="w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-75"></div>
                            <div class="w-2 h-2 bg-gray-300 rounded-full animate-pulse delay-150"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Input Area -->
            <div class="border-t border-gray-200 p-4">
                <div class="flex space-x-2 mb-3">
                    <input type="text" id="chatInput"
                           placeholder="Ask about student life, support services, or activities..."
                           class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-miu-secondary focus:border-transparent"
                           maxlength="500" />
                    <button id="sendMessage"
                            class="bg-gradient-miu text-white rounded-lg px-4 hover:opacity-90 transition-opacity flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-xs text-gray-500">
                        <span id="charCount">0/500</span> characters
                    </div>
                    <button id="voiceInput" class="text-gray-500 hover:text-miu-secondary transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Menu (Minimized State) -->
        <div id="quickMenu"
             class="hidden absolute bottom-20 right-0 w-64 bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-200 p-4">
            <h4 class="font-bold text-miu-primary mb-3">Student Life Topics</h4>
            <div class="space-y-2">
                <button class="quick-topic w-full text-left px-3 py-2 rounded-lg hover:bg-blue-50 transition-colors flex items-center"
                        data-action="academic">
                    <span class="mr-2">📚</span> Academic Support
                </button>
                <button class="quick-topic w-full text-left px-3 py-2 rounded-lg hover:bg-green-50 transition-colors flex items-center"
                        data-action="community">
                    <span class="mr-2">🌍</span> Virtual Community
                </button>
                <button class="quick-topic w-full text-left px-3 py-2 rounded-lg hover:bg-purple-50 transition-colors flex items-center"
                        data-action="activities">
                    <span class="mr-2">🎭</span> Activities & Clubs
                </button>
                <button class="quick-topic w-full text-left px-3 py-2 rounded-lg hover:bg-yellow-50 transition-colors flex items-center"
                        data-action="career">
                    <span class="mr-2">💼</span> Career Services
                </button>
                <button class="quick-topic w-full text-left px-3 py-2 rounded-lg hover:bg-pink-50 transition-colors flex items-center"
                        data-action="wellbeing">
                    <span class="mr-2">❤️</span> Wellbeing Resources
                </button>
            </div>
            <button id="openFullChat"
                    class="w-full bg-gradient-miu text-white rounded-lg py-2 mt-3 hover:opacity-90 transition-opacity">
                Open Full Chat
            </button>
        </div>
    </div>





    <script>


        // Initialize Chatbot
        document.addEventListener('DOMContentLoaded', function () {
            // DOM Elements
            const chatbotToggle = document.getElementById('chatbotToggle');
            const chatbotWindow = document.getElementById('chatbotWindow');
            const quickMenu = document.getElementById('quickMenu');
            const chatbotClose = document.getElementById('chatbotClose');
            const chatbotMinimize = document.getElementById('chatbotMinimize');
            const chatInput = document.getElementById('chatInput');
            const sendMessage = document.getElementById('sendMessage');
            const chatMessages = document.getElementById('chatMessages');
            const typingIndicator = document.getElementById('typingIndicator');
            const quickActions = document.querySelectorAll('.quick-action, .quick-topic');
            const openFullChat = document.getElementById('openFullChat');
            const voiceInput = document.getElementById('voiceInput');
            const charCount = document.getElementById('charCount');
            const notificationBadge = document.getElementById('notificationBadge');

            // Toggle Chatbot Window
            chatbotToggle.addEventListener('click', function () {
                if (!chatbotState.isOpen) {
                    openChatbot();
                } else if (chatbotState.isMinimized) {
                    openChatbot();
                } else {
                    minimizeChatbot();
                }
            });

            // Open Chatbot
            function openChatbot() {
                chatbotState.isOpen = true;
                chatbotState.isMinimized = false;
                chatbotWindow.classList.remove('hidden');
                quickMenu.classList.add('hidden');
                chatbotWindow.classList.add('chatbot-enter');

                // Hide notification badge
                notificationBadge.classList.add('hidden');

                // Focus input
                setTimeout(() => {
                    chatInput.focus();
                }, 300);

                // Update icon
                document.getElementById('chatbotIcon').textContent = '💬';
            }

            // Minimize Chatbot
            function minimizeChatbot() {
                chatbotState.isMinimized = true;
                chatbotWindow.classList.add('hidden');
                quickMenu.classList.remove('hidden');
                quickMenu.classList.add('chatbot-enter');
            }

            // Close Chatbot
            chatbotClose.addEventListener('click', function () {
                chatbotState.isOpen = false;
                chatbotState.isMinimized = false;
                chatbotWindow.classList.add('hidden');
                quickMenu.classList.add('hidden');
                document.getElementById('chatbotIcon').textContent = '💬';
            });

            // Minimize button
            chatbotMinimize.addEventListener('click', minimizeChatbot);

            // Open full chat from quick menu
            openFullChat.addEventListener('click', openChatbot);

            // Character counter
            chatInput.addEventListener('input', function () {
                charCount.textContent = `${this.value.length}/500`;
                if (this.value.length > 450) {
                    charCount.classList.add('text-red-500');
                } else {
                    charCount.classList.remove('text-red-500');
                }
            });

            // Send message function
            function sendUserMessage() {
                const message = chatInput.value.trim();
                if (message === '') return;

                // Add user message to chat
                addMessageToChat(message, 'user');

                // Clear input
                chatInput.value = '';
                charCount.textContent = '0/500';

                // Show typing indicator
                typingIndicator.classList.remove('hidden');

                // Simulate API call to backend/LLM
                setTimeout(() => {
                    typingIndicator.classList.add('hidden');
                    const response = getBotResponse(message);
                    addMessageToChat(response.text, 'bot', response.quickActions);

                    // Auto-scroll to bottom
                    scrollToBottom();
                }, 1500);
            }

            // Send message on button click
            sendMessage.addEventListener('click', sendUserMessage);

            // Send message on Enter key (but allow Shift+Enter for new line)
            chatInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendUserMessage();
                }
            });

            // Quick action buttons
            quickActions.forEach(button => {
                button.addEventListener('click', function () {
                    const action = this.getAttribute('data-action');
                    handleQuickAction(action);
                });
            });

            // Handle quick actions
            function handleQuickAction(action) {
                if (topicResponses[action]) {
                    const topic = topicResponses[action];
                    addMessageToChat(`Tell me about ${topic.title.toLowerCase()}`, 'user');

                    // Show typing indicator
                    typingIndicator.classList.remove('hidden');

                    setTimeout(() => {
                        typingIndicator.classList.add('hidden');
                        addMessageToChat(topic.response, 'bot', topic.quickActions);
                        scrollToBottom();
                    }, 1000);
                }
            }

            // Add message to chat
            function addMessageToChat(text, sender, quickActions = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${sender}-message`;

                const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                if (sender === 'user') {
                    messageDiv.innerHTML = `
            <div class="flex items-start justify-end space-x-2">
              <div class="text-right">
                <div class="message-content inline-block px-4 py-3 rounded-2xl rounded-br-none bg-gradient-miu text-white max-w-[80%]">
                  <p>${escapeHtml(text)}</p>
                </div>
                <div class="text-xs text-gray-500 mt-1 mr-1">${timestamp}</div>
              </div>
              <div class="w-8 h-8 bg-gradient-to-r from-miu-accent to-yellow-400 rounded-full flex items-center justify-center text-miu-primary font-bold text-sm">
                You
              </div>
            </div>
          `;
                } else {
                    messageDiv.innerHTML = `
            <div class="flex items-start space-x-2">
              <div class="w-8 h-8 bg-gradient-to-r from-miu-primary to-miu-secondary rounded-full flex items-center justify-center text-white text-sm">
                AI
              </div>
              <div>
                <div class="message-content bg-gray-100 rounded-2xl rounded-tl-none p-4 max-w-[80%]">
                  ${formatBotResponse(text)}
                </div>
                ${quickActions ? `
                  <div class="mt-3 flex flex-wrap gap-2">
                    ${quickActions.map(action => `
                      <button class="quick-followup bg-white border border-gray-300 hover:border-miu-secondary text-gray-700 hover:text-miu-secondary px-3 py-2 rounded-lg text-sm transition-colors" data-action="${action.action}">
                        ${action.text}
                      </button>
                    `).join('')}
                  </div>
                ` : ''}
                <div class="text-xs text-gray-500 mt-1 ml-1">${timestamp}</div>
              </div>
            </div>
          `;

                    // Add event listeners to follow-up buttons
                    if (quickActions) {
                        setTimeout(() => {
                            const followupButtons = messageDiv.querySelectorAll('.quick-followup');
                            followupButtons.forEach(button => {
                                button.addEventListener('click', function () {
                                    const action = this.getAttribute('data-action');
                                    handleFollowUpAction(action);
                                });
                            });
                        }, 100);
                    }
                }

                chatMessages.appendChild(messageDiv);
                scrollToBottom();

                // Add to conversation history
                chatbotState.conversationHistory.push({
                    sender,
                    text,
                    timestamp: new Date().toISOString()
                });
            }

            // Format bot response with markdown-like syntax
            function formatBotResponse(text) {
                // Convert **bold** to <strong>
                text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

                // Convert *italic* to <em>
                text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');

                // Convert lists
                text = text.replace(/^•\s+(.*)$/gm, '<li>$1</li>');
                text = text.replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>');

                // Convert line breaks
                text = text.replace(/\n\n/g, '<br><br>');

                // Convert URLs to links
                text = text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-miu-secondary hover:underline">$1</a>');

                return text;
            }

            // Escape HTML to prevent XSS
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Handle follow-up actions
            function handleFollowUpAction(action) {
                const responses = {
                    tutoring: "I'll help you schedule a tutoring session. What subject do you need help with?",
                    study_groups: "Great! I can connect you with study groups. Which course are you taking?",
                    workshops: "Here are the upcoming workshops...",
                    discord: "Join our Discord server: https://discord.gg/miu",
                    clubs: "View our club directory: https://miu.edu/clubs",
                    events: "Check out upcoming events: https://miu.edu/events",
                    join_club: "Which type of club are you interested in?",
                    leadership: "Here are available leadership positions...",
                    competitions: "Upcoming competitions include...",
                    coaching: "Book career coaching: https://miu.edu/career/coaching",
                    jobs: "View job postings: https://miu.edu/career/jobs",
                    career_fair: "Register for career fair: https://miu.edu/career/fair",
                    counseling: "Schedule counseling: https://miu.edu/wellbeing/counseling",
                    wellness: "Wellness workshops: https://miu.edu/wellbeing/workshops",
                    accessibility: "Accessibility services: https://miu.edu/accessibility"
                };

                if (responses[action]) {
                    addMessageToChat(responses[action], 'bot');
                    scrollToBottom();
                }
            }

            // Get bot response (simulated - in production, this would call your LLM API)
            function getBotResponse(userMessage) {
                const lowerMessage = userMessage.toLowerCase();

                // Check for specific topics
                if (lowerMessage.includes('academic') || lowerMessage.includes('tutor') || lowerMessage.includes('study')) {
                    return {
                        text: topicResponses.academic.response,
                        quickActions: topicResponses.academic.quickActions
                    };
                } else if (lowerMessage.includes('community') || lowerMessage.includes('social') || lowerMessage.includes('friend')) {
                    return {
                        text: topicResponses.community.response,
                        quickActions: topicResponses.community.quickActions
                    };
                } else if (lowerMessage.includes('activity') || lowerMessage.includes('club') || lowerMessage.includes('extracurricular')) {
                    return {
                        text: topicResponses.activities.response,
                        quickActions: topicResponses.activities.quickActions
                    };
                } else if (lowerMessage.includes('career') || lowerMessage.includes('job') || lowerMessage.includes('intern')) {
                    return {
                        text: topicResponses.career.response,
                        quickActions: topicResponses.career.quickActions
                    };
                } else if (lowerMessage.includes('wellbeing') || lowerMessage.includes('health') || lowerMessage.includes('mental')) {
                    return {
                        text: topicResponses.wellbeing.response,
                        quickActions: topicResponses.wellbeing.quickActions
                    };
                }

                // Default response
                return {
                    text: `I understand you're asking about "${userMessage}". As your Student Life Assistant, I can help you with:\n\n1. **Academic Support** - Tutoring, workshops, study groups\n2. **Virtual Community** - Clubs, events, social connections\n3. **Career Services** - Internships, job search, resume help\n4. **Wellbeing Resources** - Counseling, health services, support\n\nWhat specific area would you like to explore?`,
                    quickActions: [
                        { text: "Academic Support", action: "academic" },
                        { text: "Virtual Community", action: "community" },
                        { text: "Career Services", action: "career" }
                    ]
                };
            }

            // Scroll to bottom of chat
            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Voice input simulation
            voiceInput.addEventListener('click', function () {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();

                    recognition.lang = 'en-US';
                    recognition.interimResults = false;
                    recognition.maxAlternatives = 1;

                    recognition.start();

                    recognition.onresult = function (event) {
                        const transcript = event.results[0][0].transcript;
                        chatInput.value = transcript;
                        charCount.textContent = `${transcript.length}/500`;
                    };

                    recognition.onspeechend = function () {
                        recognition.stop();
                    };

                    recognition.onerror = function (event) {
                        console.error('Speech recognition error', event.error);
                    };
                } else {
                    alert('Speech recognition is not supported in your browser. Please use Chrome or Edge.');
                }
            });

            // Simulate new message notification
            function simulateNotification() {
                if (!chatbotState.isOpen) {
                    notificationBadge.classList.remove('hidden');
                    document.getElementById('chatbotIcon').textContent = '🔔';

                    // Add welcome back message when opened
                    setTimeout(() => {
                        if (!chatbotState.conversationHistory.some(msg =>
                            msg.text.includes('Welcome back') && msg.sender === 'bot')) {
                            const welcomeBackMessage = "Welcome back! While you were away:\n\n• 3 new study groups formed\n• Career fair registration opened\n• New wellness workshop scheduled\n\nHow can I help you today?";
                            addMessageToChat(welcomeBackMessage, 'bot');
                        }
                    }, 1000);
                }
            }

            // Simulate initial notifications after page load
            setTimeout(simulateNotification, 10000);

            // API Integration Functions (for connecting to your backend/LLM)
            window.chatbotAPI = {
                // Send message to your LLM backend
                async sendToLLM(message, context = {}) {
                    // This is where you would integrate with your actual LLM API
                    const response = await fetch('/api/chatbot', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message,
                            context: {
                                ...context,
                                conversationHistory: chatbotState.conversationHistory.slice(-10), // Send last 10 messages
                                userPreferences: chatbotState.userPreferences,
                                currentTopic: chatbotState.currentTopic
                            }
                        })
                    });

                    return await response.json();
                },

                // Update user preferences
                updatePreferences(preferences) {
                    chatbotState.userPreferences = { ...chatbotState.userPreferences, ...preferences };
                    localStorage.setItem('miuChatbotPreferences', JSON.stringify(chatbotState.userPreferences));
                },

                // Get chatbot state
                getState() {
                    return { ...chatbotState };
                },

                // Clear conversation
                clearConversation() {
                    chatbotState.conversationHistory = [];
                    chatMessages.innerHTML = `
            <div class="chat-message bot-message">
              <div class="flex items-start space-x-2">
                <div class="w-8 h-8 bg-gradient-to-r from-miu-primary to-miu-secondary rounded-full flex items-center justify-center text-white text-sm">
                  AI
                </div>
                <div>
                  <div class="bg-gray-100 rounded-2xl rounded-tl-none p-4 max-w-[80%]">
                    <p class="text-gray-800">👋 Welcome to MIU Student Life Assistant! I'm here to help you explore campus life, academic support, extracurricular activities, career services, and wellbeing resources. How can I assist you today?</p>
                  </div>
                </div>
              </div>
            </div>
          `;
                }
            };

            // Load saved preferences
            const savedPreferences = localStorage.getItem('miuChatbotPreferences');
            if (savedPreferences) {
                chatbotState.userPreferences = JSON.parse(savedPreferences);
            }
        });
    </script>
    </body>
</html>