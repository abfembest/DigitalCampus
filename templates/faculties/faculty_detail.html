{% extends 'base.html' %}
{% load static %}

{% block title %}{{ faculty.name }} | MIU – Modern International University{% endblock %}

{% block meta_tags %}
<meta name="description" content="{{ faculty.meta_description|default:faculty.description|truncatewords:30 }}">
<meta name="keywords" content="{{ faculty.meta_keywords|default:'faculty, university programs, MIU' }}">
{% endblock %}

{% block canonical %}
<link rel="canonical" href="{{ request.build_absolute_uri }}">
{% endblock %}

{% block og_tags %}
<meta property="og:type" content="website">
<meta property="og:title" content="{{ faculty.name }} | MIU">
<meta property="og:description" content="{{ faculty.description|truncatewords:30 }}">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:image" content="{% if faculty.about_image %}{{ request.scheme }}://{{ request.get_host }}{{ faculty.about_image.url }}{% else %}{% static 'images/og-image.jpg' %}{% endif %}">
{% endblock %}

{% block twitter_tags %}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ faculty.name }} | MIU">
<meta name="twitter:description" content="{{ faculty.description|truncatewords:30 }}">
<meta name="twitter:image" content="{% if faculty.about_image %}{{ request.scheme }}://{{ request.get_host }}{{ faculty.about_image.url }}{% else %}{% static 'images/og-image.jpg' %}{% endif %}">
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "EducationalOrganization",
  "name": "{{ faculty.name }}",
  "description": "{{ faculty.description|escapejs }}",
  "url": "{{ request.build_absolute_uri }}",
  "parentOrganization": {
    "@type": "CollegeOrUniversity",
    "name": "Modern International University",
    "url": "{{ request.scheme }}://{{ request.get_host }}"
  }
}
</script>
{% endblock %}

{% block extra_css %}
<style>
  /* ── Department Tab States ──────────────────────── */
  .dept-tab-active {
    background: linear-gradient(135deg, #840384 0%, #9333ea 100%);
    color: #fff;
    border-color: transparent;
    box-shadow: 0 4px 14px rgba(132,3,132,0.22);
  }
  .dept-tab-active .dept-code  { color: rgba(255,255,255,0.65); }
  .dept-tab-active .dept-count { background: rgba(255,255,255,0.18); color: #fff; }

  .dept-tab-inactive {
    background: #ffffff;
    color: #374151;
    border-color: #e5e7eb;
  }
  .dept-tab-inactive:hover {
    border-color: #c084fc;
    background: #faf5ff;
    color: #1f2937;
  }
  .dept-tab-inactive .dept-code  { color: #9333ea; }
  .dept-tab-inactive .dept-count { background: #f3e8ff; color: #7e22ce; }

  /* ── Program card hover ─────────────────────────── */
  .prog-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
  }
  .prog-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 16px 40px rgba(132,3,132,0.10);
    border-color: #c084fc;
  }

  /* ── Degree level badge colours ─────────────────── */
  .badge-certificate   { background:#fef3c7; color:#92400e; }
  .badge-diploma       { background:#dbeafe; color:#1e40af; }
  .badge-undergraduate { background:#d1fae5; color:#065f46; }
  .badge-postgraduate  { background:#ede9fe; color:#5b21b6; }
  .badge-masters       { background:#fce7f3; color:#9d174d; }
  .badge-phd           { background:#fee2e2; color:#991b1b; }

  /* ── Panel fade-in ──────────────────────────────── */
  .dept-panel { animation: panelIn 0.22s ease; }
  @keyframes panelIn {
    from { opacity:0; transform:translateY(8px); }
    to   { opacity:1; transform:translateY(0); }
  }

  /* ── Sticky sidebar ─────────────────────────────── */
  @media (min-width:1024px) {
    .sidebar-sticky { position:sticky; top:108px; }
  }
</style>
{% endblock %}

{% block content %}
<main id="main-content">

  <!-- ══════════ HERO ══════════ -->
  <section
    class="relative bg-gradient-to-br from-primary-950 via-primary-900 to-purple-900 text-white overflow-hidden"
    role="banner"
    aria-labelledby="faculty-heading">

    <!-- Ambient blobs -->
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <div class="absolute -top-24 -left-24 w-96 h-96 bg-purple-500 rounded-full blur-3xl opacity-20"></div>
      <div class="absolute bottom-0 right-0 w-[480px] h-[480px] bg-primary-800 rounded-full blur-3xl opacity-25"></div>
    </div>

    {% if faculty.hero_image %}
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <img src="{{ faculty.hero_image.url }}" alt=""
           class="w-full h-full object-cover opacity-10" loading="eager">
    </div>
    {% endif %}

    <div class="container mx-auto relative z-10 pt-32 pb-20 lg:pt-40 lg:pb-28">

      <!-- Breadcrumb -->
      <nav aria-label="Breadcrumb" class="mb-8">
        <ol class="flex flex-wrap items-center gap-1.5 text-sm font-sans"
            itemscope itemtype="https://schema.org/BreadcrumbList">
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="{% url 'eduweb:index' %}" itemprop="item"
               class="text-purple-300 hover:text-white transition-colors duration-200 focus:outline-none focus:underline">
              <span itemprop="name">Home</span>
            </a>
            <meta itemprop="position" content="1">
          </li>
          <li aria-hidden="true">
            <i data-lucide="chevron-right" class="w-3.5 h-3.5 text-purple-500 inline-block align-middle"></i>
          </li>
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name" class="text-purple-300">Faculties</span>
            <meta itemprop="position" content="2">
          </li>
          <li aria-hidden="true">
            <i data-lucide="chevron-right" class="w-3.5 h-3.5 text-purple-500 inline-block align-middle"></i>
          </li>
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name" class="text-white font-medium">{{ faculty.name }}</span>
            <meta itemprop="position" content="3">
          </li>
        </ol>
      </nav>

      <!-- Identity -->
      <div class="flex flex-col sm:flex-row items-start gap-6 mb-8">
        <div class="w-16 h-16 lg:w-20 lg:h-20 rounded-2xl flex-shrink-0 flex items-center justify-center shadow-2xl"
             style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);"
             aria-hidden="true">
          <i data-lucide="{{ faculty.icon }}" class="w-8 h-8 lg:w-10 lg:h-10 text-white"></i>
        </div>
        <div>
          {% if faculty.tagline %}
          <p class="text-purple-300 text-xs font-semibold uppercase tracking-widest mb-2">{{ faculty.tagline }}</p>
          {% endif %}
          <h1 id="faculty-heading"
              class="font-display text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight text-white">
            {{ faculty.name }}
          </h1>
          <span class="inline-block mt-3 px-3 py-1 text-xs font-bold tracking-widest uppercase rounded-full"
                style="background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.75);border:1px solid rgba(255,255,255,0.15);">
            {{ faculty.code }}
          </span>
        </div>
      </div>

      {% if faculty.description %}
      <p class="text-base lg:text-lg text-purple-100 leading-relaxed max-w-3xl mb-10 font-sans">
        {{ faculty.description|truncatewords:55 }}
      </p>
      {% endif %}

      <!-- CTAs -->
      <div class="flex flex-wrap gap-3">
        <a href="{% url 'eduweb:apply' %}"
           class="inline-flex items-center gap-2 px-6 py-3 bg-white text-primary-950 rounded-xl font-semibold text-sm hover:bg-purple-50 hover:scale-105 transition-all duration-300 shadow-xl shadow-black/20 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950"
           aria-label="Apply to {{ faculty.name }}">
          Apply Now
          <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
        </a>
        <a href="#departments"
           class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-sm text-white transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950"
           style="border:1.5px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.08);"
           aria-label="Browse departments">
          Browse Departments
          <i data-lucide="layers" class="w-4 h-4" aria-hidden="true"></i>
        </a>
      </div>

    </div>
  </section>

  <!-- ══════════ STATS BAR ══════════ -->
  <section class="bg-white border-b border-gray-100" aria-label="Faculty statistics">
    <div class="container mx-auto">
      <div class="grid grid-cols-2 lg:grid-cols-4 divide-x divide-gray-100">

        {% if faculty.student_count %}
        <div class="py-8 px-6 text-center">
          <p class="font-display text-3xl lg:text-4xl font-bold text-primary-950">{{ faculty.student_count }}+</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium">Students Enrolled</p>
        </div>
        {% endif %}

        {% if departments %}
        <div class="py-8 px-6 text-center">
          <p class="font-display text-3xl lg:text-4xl font-bold text-primary-950">{{ departments|length }}</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium">Departments</p>
        </div>
        {% endif %}

        {% if faculty.placement_rate %}
        <div class="py-8 px-6 text-center">
          <p class="font-display text-3xl lg:text-4xl font-bold text-primary-950">{{ faculty.placement_rate }}%</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium">Placement Rate</p>
        </div>
        {% endif %}

        {% if faculty.partner_count %}
        <div class="py-8 px-6 text-center">
          <p class="font-display text-3xl lg:text-4xl font-bold text-primary-950">{{ faculty.partner_count }}+</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium">Industry Partners</p>
        </div>
        {% endif %}

      </div>
    </div>
  </section>

  <!-- ══════════ MISSION / VISION ══════════ -->
  {% if faculty.mission or faculty.vision %}
  <section class="py-16 bg-gray-50" aria-labelledby="mv-heading">
    <div class="container mx-auto">
      <h2 id="mv-heading" class="sr-only">Mission and Vision</h2>
      <div class="grid md:grid-cols-2 gap-6 max-w-5xl mx-auto">

        {% if faculty.mission %}
        <article class="bg-white rounded-2xl p-8 border border-gray-100 shadow-sm hover:shadow-md transition-shadow duration-300">
          <header class="flex items-center gap-3 mb-5">
            <div class="w-10 h-10 rounded-xl bg-primary-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <i data-lucide="target" class="w-5 h-5 text-primary-700"></i>
            </div>
            <h3 class="font-display text-base font-bold text-gray-900">Our Mission</h3>
          </header>
          <p class="text-gray-600 leading-relaxed text-sm">{{ faculty.mission }}</p>
        </article>
        {% endif %}

        {% if faculty.vision %}
        <article class="bg-white rounded-2xl p-8 border border-gray-100 shadow-sm hover:shadow-md transition-shadow duration-300">
          <header class="flex items-center gap-3 mb-5">
            <div class="w-10 h-10 rounded-xl bg-accent-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <i data-lucide="eye" class="w-5 h-5 text-accent-600"></i>
            </div>
            <h3 class="font-display text-base font-bold text-gray-900">Our Vision</h3>
          </header>
          <p class="text-gray-600 leading-relaxed text-sm">{{ faculty.vision }}</p>
        </article>
        {% endif %}

      </div>
    </div>
  </section>
  {% endif %}

  <!-- ══════════ DEPARTMENTS & PROGRAMS ══════════ -->
  <section id="departments" class="py-16 lg:py-24 bg-white" aria-labelledby="depts-heading">
    <div class="container mx-auto">

      <!-- Section label -->
      <div class="max-w-2xl mb-12 lg:mb-14">
        <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2">Academic Structure</p>
        <h2 id="depts-heading" class="font-display text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
          Departments &amp; Programs
        </h2>
        <p class="text-gray-500 text-base leading-relaxed">
          Select a department on the left to see its programs. From any program you can explore the full course schedule.
        </p>
      </div>

      {% if departments %}
      <div class="flex flex-col lg:flex-row gap-8 items-start">

        <!-- Sidebar -->
        <aside class="lg:w-72 w-full flex-shrink-0 sidebar-sticky" aria-label="Department navigation">
          <div class="bg-gray-50 rounded-2xl p-3 border border-gray-100">
            <p class="text-xs font-bold uppercase tracking-widest text-gray-400 px-3 pt-2 pb-3">Departments</p>
            <div role="tablist" aria-label="Select a department" class="space-y-1.5">
              {% for dept in departments %}
              <button
                id="tab-{{ dept.slug }}"
                role="tab"
                data-dept="{{ dept.slug }}"
                aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                aria-controls="panel-{{ dept.slug }}"
                class="dept-tab w-full text-left px-4 py-3.5 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-1 flex items-start justify-between gap-3
                       {% if forloop.first %}dept-tab-active{% else %}dept-tab-inactive{% endif %}">
                <span class="flex-1 min-w-0">
                  <span class="dept-code block text-xs font-bold uppercase tracking-wider mb-0.5 truncate">{{ dept.code }}</span>
                  <span class="block text-sm font-semibold leading-snug">{{ dept.name }}</span>
                </span>
                <span class="dept-count text-xs font-bold px-2 py-0.5 rounded-full flex-shrink-0 mt-0.5 whitespace-nowrap">
                  {{ dept.active_programs|length }}
                </span>
              </button>
              {% endfor %}
            </div>
          </div>
        </aside>

        <!-- Program panels -->
        <div class="flex-1 min-w-0">
          {% for dept in departments %}
          <div
            id="panel-{{ dept.slug }}"
            role="tabpanel"
            aria-labelledby="tab-{{ dept.slug }}"
            tabindex="0"
            class="dept-panel {% if not forloop.first %}hidden{% endif %} focus:outline-none">

            <!-- Department header -->
            <div class="mb-6 pb-5 border-b border-gray-100">
              <div class="flex flex-wrap items-start justify-between gap-2">
                <div>
                  <span class="text-xs font-bold uppercase tracking-widest text-primary-600 mb-1 block">{{ dept.code }}</span>
                  <h3 class="font-display text-2xl font-bold text-gray-900">{{ dept.name }}</h3>
                  {% if dept.description %}
                  <p class="text-gray-500 text-sm mt-2 leading-relaxed max-w-xl">{{ dept.description }}</p>
                  {% endif %}
                </div>
                <span class="text-sm text-gray-400 font-medium pt-1">
                  {{ dept.active_programs|length }} program{% if dept.active_programs|length != 1 %}s{% endif %}
                </span>
              </div>
            </div>

            {% if dept.active_programs %}
            <div class="grid sm:grid-cols-2 xl:grid-cols-3 gap-5">
              {% for program in dept.active_programs %}
              <article class="prog-card bg-white border border-gray-200 rounded-2xl flex flex-col overflow-hidden">

                <!-- Accent bar -->
                <div class="h-1 bg-gradient-to-r from-primary-600 to-purple-400" aria-hidden="true"></div>

                <div class="p-5 lg:p-6 flex flex-col flex-1">

                  <!-- Degree badge — dynamic via program.degree_level -->
                  <span class="inline-block text-xs font-bold uppercase tracking-wide px-2.5 py-1 rounded-full mb-4 w-fit badge-{{ program.degree_level }}">
                    {{ program.get_degree_level_display }}
                  </span>

                  <h4 class="font-display text-base font-bold text-gray-900 leading-snug mb-1">{{ program.name }}</h4>
                  <p class="text-xs text-gray-400 font-mono mb-3">{{ program.code }}</p>

                  {% if program.description %}
                  <p class="text-sm text-gray-500 leading-relaxed mb-4 flex-1 line-clamp-2">{{ program.description }}</p>
                  {% else %}
                  <div class="flex-1"></div>
                  {% endif %}

                  <!-- Meta chips -->
                  <ul class="flex flex-wrap gap-x-4 gap-y-1.5 text-xs text-gray-400 mb-5 pt-3 border-t border-gray-50"
                      aria-label="Program details">
                    <li class="flex items-center gap-1.5">
                      <i data-lucide="clock" class="w-3.5 h-3.5 text-primary-400" aria-hidden="true"></i>
                      {{ program.duration_years }} yr{% if program.duration_years != 1 %}s{% endif %}
                    </li>
                    <li class="flex items-center gap-1.5">
                      <i data-lucide="book-open" class="w-3.5 h-3.5 text-primary-400" aria-hidden="true"></i>
                      {{ program.credits_required }} credits
                    </li>
                    {% if program.tuition_fee %}
                    <li class="flex items-center gap-1.5">
                      <i data-lucide="dollar-sign" class="w-3.5 h-3.5 text-primary-400" aria-hidden="true"></i>
                      ${{ program.tuition_fee|floatformat:0 }}/yr
                    </li>
                    {% endif %}
                  </ul>

                  <!-- View Programs -->
                  <a href="{% url 'eduweb:program_detail' program.slug %}"
                     class="inline-flex items-center justify-center gap-2 w-full px-4 py-2.5 rounded-xl text-sm font-semibold bg-primary-950 text-white hover:bg-primary-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2"
                     aria-label="View Programs in {{ program.name }}">
                    View Programs
                    <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
                  </a>

                </div>
              </article>
              {% endfor %}
            </div>

            {% else %}
            <div class="flex flex-col items-center justify-center text-center py-20 rounded-2xl border-2 border-dashed border-gray-200 bg-gray-50"
                 role="status">
              <i data-lucide="folder-open" class="w-12 h-12 text-gray-300 mb-3" aria-hidden="true"></i>
              <p class="font-semibold text-gray-400">No programs in this department yet</p>
              <p class="text-sm text-gray-400 mt-1">Check back soon for updates.</p>
            </div>
            {% endif %}

          </div>
          {% endfor %}
        </div>

      </div>

      {% else %}
      <!-- Whole-section empty state -->
      <div class="flex flex-col items-center justify-center text-center py-24 rounded-2xl border-2 border-dashed border-gray-200"
           role="status">
        <i data-lucide="inbox" class="w-14 h-14 text-gray-300 mb-4" aria-hidden="true"></i>
        <p class="font-display text-lg font-semibold text-gray-400 mb-2">No departments listed yet</p>
        <p class="text-sm text-gray-400 mb-6">This faculty is being set up. Check back soon.</p>
        <a href="{% url 'eduweb:index' %}"
           class="inline-flex items-center gap-2 text-sm font-semibold text-primary-700 hover:text-primary-900 transition-colors duration-200 focus:outline-none focus:underline">
          Explore Other Faculties
          <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
        </a>
      </div>
      {% endif %}

    </div>
  </section>

  <!-- ══════════ SPECIAL FEATURES ══════════
       Rendered dynamically from faculty.special_features (JSONField).
       Each item must be: { "title": "...", "description": "...", "icon": "..." }
       Added/edited via Django Admin → Faculty → Special Features.
       Section is hidden entirely if the JSON list is empty.
  ══════════════════════════════════════════ -->
  {% if faculty.special_features %}
  <section class="py-16 lg:py-20 bg-gray-50" aria-labelledby="features-heading">
    <div class="container mx-auto">

      <div class="max-w-2xl mb-12">
        <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2">What Sets Us Apart</p>
        <h2 id="features-heading" class="font-display text-3xl lg:text-4xl font-bold text-gray-900">
          Distinctive Features
        </h2>
      </div>

      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-5">
        {% for feature in faculty.special_features %}
        <article class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200">
          <div class="w-11 h-11 rounded-xl bg-primary-50 flex items-center justify-center mb-5 flex-shrink-0" aria-hidden="true">
            <i data-lucide="{{ feature.icon|default:'star' }}" class="w-5 h-5 text-primary-700"></i>
          </div>
          <h3 class="font-display text-sm font-bold text-gray-900 mb-2">{{ feature.title }}</h3>
          <p class="text-xs text-gray-500 leading-relaxed">{{ feature.description }}</p>
        </article>
        {% endfor %}
      </div>

    </div>
  </section>
  {% endif %}

  <!-- ══════════ ACCREDITATION ══════════ -->
  {% if faculty.accreditation %}
  <section class="py-12 bg-white border-y border-gray-100" aria-labelledby="accred-heading">
    <div class="container mx-auto max-w-4xl">
      <div class="flex flex-col sm:flex-row items-start gap-5">
        <div class="w-11 h-11 rounded-xl bg-gold-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
          <i data-lucide="shield-check" class="w-5 h-5 text-gold-600"></i>
        </div>
        <div>
          <h2 id="accred-heading" class="font-display text-base font-bold text-gray-900 mb-2">Accreditation</h2>
          <p class="text-gray-600 text-sm leading-relaxed">{{ faculty.accreditation }}</p>
        </div>
      </div>
    </div>
  </section>
  {% endif %}

  <!-- ══════════ CTA BANNER ══════════ -->
  <section class="py-20 lg:py-24 bg-white" aria-labelledby="cta-heading">
    <div class="container mx-auto">
      <div class="max-w-5xl mx-auto bg-gradient-to-br from-primary-950 via-primary-900 to-purple-900 rounded-3xl px-8 py-14 lg:px-16 relative overflow-hidden">

        <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
          <div class="absolute -bottom-16 -right-16 w-64 h-64 bg-purple-600 rounded-full blur-3xl opacity-30"></div>
          <div class="absolute top-0 left-0 w-48 h-48 bg-primary-700 rounded-full blur-3xl opacity-20"></div>
        </div>

        <div class="relative z-10 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-8">
          <div class="flex-1">
            <p class="text-purple-300 text-xs font-bold uppercase tracking-widest mb-3">Start Your Journey</p>
            <h2 id="cta-heading" class="font-display text-2xl lg:text-3xl font-bold text-white mb-3">
              Ready to Join {{ faculty.name }}?
            </h2>
            <p class="text-purple-200 text-sm leading-relaxed max-w-lg">
              Apply today and become part of a community built for innovation, excellence, and real-world impact.
            </p>
          </div>
          <div class="flex flex-wrap gap-3 flex-shrink-0">
            <a href="{% url 'eduweb:apply' %}"
               class="inline-flex items-center gap-2 px-6 py-3 bg-white text-primary-950 rounded-xl font-semibold text-sm hover:bg-purple-50 hover:scale-105 transition-all duration-300 shadow-xl shadow-black/20 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950">
              Apply Now
              <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
            </a>
            <a href="{% url 'eduweb:admission_requirement' %}"
               class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-sm text-white transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950"
               style="border:1.5px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.08);">
              View Requirements
              <i data-lucide="list-checks" class="w-4 h-4" aria-hidden="true"></i>
            </a>
          </div>
        </div>

      </div>
    </div>
  </section>

</main>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  lucide.createIcons();

  const tabs   = Array.from(document.querySelectorAll('.dept-tab'));
  const panels = Array.from(document.querySelectorAll('.dept-panel'));

  function activate(slug) {
    tabs.forEach(function (tab) {
      const isActive = tab.dataset.dept === slug;
      tab.setAttribute('aria-selected', String(isActive));

      if (isActive) {
        tab.classList.remove('dept-tab-inactive');
        tab.classList.add('dept-tab-active');
      } else {
        tab.classList.remove('dept-tab-active');
        tab.classList.add('dept-tab-inactive');
      }
    });

    panels.forEach(function (panel) {
      const show = panel.id === 'panel-' + slug;
      panel.classList.toggle('hidden', !show);
      if (show) { panel.focus({ preventScroll: true }); }
    });
  }

  tabs.forEach(function (tab) {
    tab.addEventListener('click', function () {
      activate(tab.dataset.dept);
    });

    // Full ARIA keyboard pattern
    tab.addEventListener('keydown', function (e) {
      const idx = tabs.indexOf(tab);
      const map = {
        ArrowDown:  (idx + 1) % tabs.length,
        ArrowRight: (idx + 1) % tabs.length,
        ArrowUp:    (idx - 1 + tabs.length) % tabs.length,
        ArrowLeft:  (idx - 1 + tabs.length) % tabs.length,
        Home:       0,
        End:        tabs.length - 1,
      };
      if (e.key in map) {
        e.preventDefault();
        tabs[map[e.key]].focus();
      }
    });
  });
});
</script>
{% endblock %}