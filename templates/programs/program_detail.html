{% extends 'base.html' %}
{% load static %}

{% block title %}{{ program.name }} | MIU – Melchisedec International University{% endblock %}

{% block meta_tags %}
<meta name="description" content="{{ program.meta_description|default:program.description|truncatewords:30 }}">
<meta name="keywords" content="{{ program.name }}, {{ program.get_degree_level_display }}, MIU, university program">
{% endblock %}

{% block canonical %}
<link rel="canonical" href="{{ request.build_absolute_uri }}">
{% endblock %}

{% block og_tags %}
<meta property="og:type" content="website">
<meta property="og:title" content="{{ program.name }} | MIU">
<meta property="og:description" content="{{ program.description|truncatewords:30 }}">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:image" content="{% static 'images/og-image.jpg' %}">
{% endblock %}

{% block twitter_tags %}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ program.name }} | MIU">
<meta name="twitter:description" content="{{ program.description|truncatewords:30 }}">
<meta name="twitter:image" content="{% static 'images/og-image.jpg' %}">
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Course",
  "name": "{{ program.name|escapejs }}",
  "description": "{{ program.description|escapejs }}",
  "provider": {
    "@type": "CollegeOrUniversity",
    "name": "Melchisedec International University",
    "url": "{{ request.scheme }}://{{ request.get_host }}"
  },
  "educationalLevel": "{{ program.get_degree_level_display }}",
  "timeRequired": "P{{ program.duration_years }}Y"
}
</script>
{% endblock %}

{% block extra_css %}
<style>
  /* ── Degree badge colours ─────────────────────── */
  .badge-certificate   { background:#fef3c7; color:#92400e; }
  .badge-diploma       { background:#dbeafe; color:#1e40af; }
  .badge-undergraduate { background:#d1fae5; color:#065f46; }
  .badge-postgraduate  { background:#ede9fe; color:#5b21b6; }
  .badge-masters       { background:#fce7f3; color:#9d174d; }
  .badge-phd           { background:#fee2e2; color:#991b1b; }

  /* ── Course type badge colours ───────────────── */
  .ctype-core         { background:#d1fae5; color:#065f46; }
  .ctype-elective     { background:#ede9fe; color:#5b21b6; }
  .ctype-general      { background:#fef3c7; color:#92400e; }
  .ctype-prerequisite { background:#fee2e2; color:#991b1b; }

  /* ── Semester heading colours ────────────────── */
  .sem-first  { border-left: 3px solid #6366f1; }
  .sem-second { border-left: 3px solid #a855f7; }
  .sem-annual { border-left: 3px solid #f59e0b; }

  /* ── Intake session badges ───────────────────── */
  .intake-january   { background:#dbeafe; color:#1e40af; }
  .intake-may       { background:#d1fae5; color:#065f46; }
  .intake-september { background:#fef3c7; color:#92400e; }

  /* ── Course card ─────────────────────────────── */
  .course-card {
    transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
  }
  .course-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(132,3,132,0.09);
    border-color: #c084fc;
  }

  /* ── Intake accordion ────────────────────────── */
  .intake-accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .intake-accordion-content.open { max-height: 9999px; }
  .intake-chevron { transition: transform 0.3s ease; }
  .intake-toggle.open .intake-chevron { transform: rotate(180deg); }

  /* ── Sticky sidebar ─────────────────────────── */
  @media (min-width: 1024px) {
    .prog-sidebar-sticky { position: sticky; top: 108px; }
  }

  /* ── Section reveal animation ──────────────── */
  .section-reveal {
    animation: revealUp 0.3s ease both;
  }
  @keyframes revealUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ── Year group divider ─────────────────────── */
  .year-group-header {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .year-group-header::after {
    content: '';
    flex: 1;
    height: 1px;
    background: #e5e7eb;
  }
</style>
{% endblock %}

{% block content %}
<main id="main-content">

  <!-- ══════════════════════════════════════════════════
       HERO
  ══════════════════════════════════════════════════ -->
  <section
    class="relative bg-gradient-to-br from-primary-950 via-primary-900 to-purple-900 text-white overflow-hidden"
    role="banner"
    aria-labelledby="program-heading">

    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <div class="absolute -top-24 -left-24 w-96 h-96 bg-purple-500 rounded-full blur-3xl opacity-20"></div>
      <div class="absolute bottom-0 right-0 w-[480px] h-[480px] bg-primary-800 rounded-full blur-3xl opacity-25"></div>
      <div class="absolute top-1/3 left-1/2 w-[400px] h-[400px] bg-purple-700 rounded-full blur-3xl opacity-10"></div>
    </div>

    {% if program.hero_image %}
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <img src="{{ program.hero_image.url }}" alt="" class="w-full h-full object-cover opacity-10" loading="eager">
    </div>
    {% endif %}

    <div class="container mx-auto relative z-10 pt-32 pb-20 lg:pt-40 lg:pb-28 px-4 lg:px-6">

      <!-- Breadcrumb -->
      <nav aria-label="Breadcrumb" class="mb-8">
        <ol class="flex flex-wrap items-center gap-1.5 text-sm font-['Inter']"
            itemscope itemtype="https://schema.org/BreadcrumbList">
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="{% url 'eduweb:index' %}" itemprop="item"
               class="text-purple-300 hover:text-white transition-colors duration-200 focus:outline-none focus:underline">
              <span itemprop="name">Home</span></a>
            <meta itemprop="position" content="1">
          </li>
          <li aria-hidden="true"><i data-lucide="chevron-right" class="w-3.5 h-3.5 text-purple-500 inline-block align-middle"></i></li>
          {% if faculty %}
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="{% url 'eduweb:faculty_detail' faculty.slug %}" itemprop="item"
               class="text-purple-300 hover:text-white transition-colors duration-200 focus:outline-none focus:underline">
              <span itemprop="name">{{ faculty.name }}</span></a>
            <meta itemprop="position" content="2">
          </li>
          <li aria-hidden="true"><i data-lucide="chevron-right" class="w-3.5 h-3.5 text-purple-500 inline-block align-middle"></i></li>
          {% endif %}
          {% if department %}
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name" class="text-purple-300">{{ department.name }}</span>
            <meta itemprop="position" content="3">
          </li>
          <li aria-hidden="true"><i data-lucide="chevron-right" class="w-3.5 h-3.5 text-purple-500 inline-block align-middle"></i></li>
          {% endif %}
          <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name" class="text-white font-medium">{{ program.name }}</span>
            <meta itemprop="position" content="4">
          </li>
        </ol>
      </nav>

      <!-- Program Identity -->
      <div class="flex flex-col sm:flex-row items-start gap-5 mb-6">
        <div class="w-16 h-16 lg:w-20 lg:h-20 rounded-2xl flex-shrink-0 flex items-center justify-center shadow-2xl"
             style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);" aria-hidden="true">
          <i data-lucide="graduation-cap" class="w-8 h-8 lg:w-10 lg:h-10 text-white"></i>
        </div>
        <div class="flex-1">
          <p class="text-purple-300 text-xs font-semibold mb-2 flex flex-wrap items-center gap-1.5 font-['Inter']">
            {% if faculty %}<span>{{ faculty.name }}</span><i data-lucide="chevron-right" class="w-3 h-3 inline-block" aria-hidden="true"></i>{% endif %}
            {% if department %}<span>{{ department.name }}</span>{% endif %}
          </p>
          <h1 id="program-heading" class="font-['Poppins'] text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight text-white">
            {{ program.name }}
          </h1>
          <div class="flex flex-wrap gap-2 mt-4">
            <span class="px-3 py-1 text-xs font-bold uppercase tracking-wide rounded-full badge-{{ program.degree_level }} font-['Inter']">
              {{ program.get_degree_level_display }}
            </span>
            <span class="px-3 py-1 text-xs font-bold uppercase tracking-widest rounded-full font-['Inter']"
                  style="background:rgba(255,255,255,0.12);color:rgba(255,255,255,0.85);border:1px solid rgba(255,255,255,0.15);">
              {{ program.code }}
            </span>
          </div>
        </div>
      </div>

      {% if program.tagline %}
      <p class="text-purple-300 text-sm font-semibold mb-3 font-['Inter'] italic">{{ program.tagline }}</p>
      {% endif %}

      {% if program.description %}
      <p class="text-base lg:text-lg text-purple-100 leading-relaxed max-w-3xl mb-10 font-['Inter']">
        {{ program.description|truncatewords:60 }}
      </p>
      {% endif %}

      <!-- CTAs -->
      <div class="flex flex-wrap gap-3">
        <a href="{% url 'eduweb:apply' %}"
           class="inline-flex items-center gap-2 px-6 py-3 bg-white text-primary-950 rounded-xl font-semibold text-sm hover:bg-purple-50 hover:scale-105 transition-all duration-300 shadow-xl shadow-black/20 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950 font-['Inter']">
          Apply Now
          <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
        </a>
        <a href="#courses"
           class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-sm text-white transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950 font-['Inter']"
           style="border:1.5px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.08);">
          View Courses
          <i data-lucide="book-open" class="w-4 h-4" aria-hidden="true"></i>
        </a>
      </div>

    </div>
  </section>

  <!-- ══════════════════════════════════════════════════
       STATS BAR
  ══════════════════════════════════════════════════ -->
  <section class="bg-white border-b border-gray-100" aria-label="Program at a glance">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="grid grid-cols-2 lg:grid-cols-4 divide-x divide-gray-100">

        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">
            {{ program.duration_years }}<span class="text-xl"> yr{% if program.duration_years != 1 %}s{% endif %}</span>
          </p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Duration</p>
        </div>

        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">{{ program.credits_required }}</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Credits Required</p>
        </div>

        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">{{ courses|length }}</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Total Courses</p>
        </div>

        {% if program.job_placement_rate %}
        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">{{ program.job_placement_rate }}%</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Placement Rate</p>
        </div>
        {% elif program.tuition_fee %}
        <div class="py-8 px-6 text-center">
          <p class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-primary-950">${{ program.tuition_fee|floatformat:0 }}</p>
          <p class="text-sm text-gray-400 mt-1.5 font-medium font-['Inter']">Tuition / Year</p>
        </div>
        {% endif %}

      </div>
    </div>
  </section>

  <!-- ══════════════════════════════════════════════════
       OVERVIEW
  ══════════════════════════════════════════════════ -->
  {% if program.description %}
  <section class="py-16 bg-white" aria-labelledby="overview-heading">
    <div class="container mx-auto px-4 lg:px-6 max-w-4xl">
      <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">About This Program</p>
      <h2 id="overview-heading" class="font-['Poppins'] text-3xl font-bold text-gray-900 mb-6">Program Overview</h2>
      <div class="h-0.5 w-14 bg-gradient-to-r from-primary-600 to-purple-400 mb-8" aria-hidden="true"></div>
      <p class="text-gray-600 leading-relaxed text-base lg:text-lg font-['Inter']">{{ program.description }}</p>
    </div>
  </section>
  {% endif %}

  <!-- ══════════════════════════════════════════════════
       ENTRY REQUIREMENTS
  ══════════════════════════════════════════════════ -->
  {% if program.entry_requirements %}
  <section class="py-16 bg-gray-50" aria-labelledby="req-heading">
    <div class="container mx-auto px-4 lg:px-6 max-w-4xl">
      <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Admissions</p>
      <h2 id="req-heading" class="font-['Poppins'] text-3xl font-bold text-gray-900 mb-6">Entry Requirements</h2>
      <div class="h-0.5 w-14 bg-gradient-to-r from-primary-600 to-purple-400 mb-8" aria-hidden="true"></div>
      <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-8">
        <ul class="space-y-4" role="list">
          {% for req in program.entry_requirements %}
          <li class="flex items-start gap-3">
            <div class="w-5 h-5 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0 mt-0.5" aria-hidden="true">
              <i data-lucide="check" class="w-3 h-3 text-primary-700"></i>
            </div>
            <span class="text-gray-700 text-sm lg:text-base font-['Inter']">{{ req }}</span>
          </li>
          {% endfor %}
        </ul>
        <div class="mt-8 pt-6 border-t border-gray-100">
          <a href="{% url 'eduweb:admission_requirement' %}"
             class="inline-flex items-center gap-2 text-sm font-semibold text-primary-700 hover:text-primary-900 transition-colors focus:outline-none focus:underline font-['Inter']">
            View Full Admission Requirements
            <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
          </a>
        </div>
      </div>
    </div>
  </section>
  {% endif %}

  <!-- ══════════════════════════════════════════════════
       LEARNING OUTCOMES + CAREER PATHS  (two-col)
  ══════════════════════════════════════════════════ -->
  {% if program.learning_outcomes or program.career_paths %}
  <section class="py-16 bg-white" aria-labelledby="outcomes-heading">
    <div class="container mx-auto px-4 lg:px-6">
      <h2 id="outcomes-heading" class="sr-only">Outcomes and Careers</h2>
      <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">

        {% if program.learning_outcomes %}
        <div>
          <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">What You'll Learn</p>
          <h3 class="font-['Poppins'] text-2xl font-bold text-gray-900 mb-6">Learning Outcomes</h3>
          <ul class="space-y-3" role="list">
            {% for outcome in program.learning_outcomes %}
            <li class="flex items-start gap-3">
              <div class="w-5 h-5 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0 mt-0.5" aria-hidden="true">
                <i data-lucide="check" class="w-3 h-3 text-primary-700"></i>
              </div>
              <span class="text-gray-700 text-sm font-['Inter']">{{ outcome }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        {% if program.career_paths %}
        <div>
          <p class="text-purple-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Where You'll Go</p>
          <h3 class="font-['Poppins'] text-2xl font-bold text-gray-900 mb-6">Career Paths</h3>
          {% if program.avg_starting_salary %}
          <div class="flex items-center gap-2 mb-5 p-3 bg-purple-50 rounded-xl border border-purple-100">
            <i data-lucide="trending-up" class="w-4 h-4 text-purple-600 flex-shrink-0" aria-hidden="true"></i>
            <p class="text-sm font-['Inter']"><span class="font-bold text-purple-800">Avg. Starting Salary:</span> <span class="text-purple-700">{{ program.avg_starting_salary }}</span></p>
          </div>
          {% endif %}
          <ul class="space-y-3" role="list">
            {% for path in program.career_paths %}
            <li class="flex items-start gap-3">
              <div class="w-5 h-5 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0 mt-0.5" aria-hidden="true">
                <i data-lucide="briefcase" class="w-3 h-3 text-purple-700"></i>
              </div>
              <span class="text-gray-700 text-sm font-['Inter']">{{ path }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

      </div>
    </div>
  </section>
  {% endif %}

  <!-- ══════════════════════════════════════════════════
       INTAKE SESSIONS (linked to Program, not Course)
  ══════════════════════════════════════════════════ -->
  {% if active_intakes %}
  <section class="py-16 bg-gray-50" aria-labelledby="intakes-heading">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-2xl mb-10">
        <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Enrolment Windows</p>
        <h2 id="intakes-heading" class="font-['Poppins'] text-3xl font-bold text-gray-900 mb-3">Available Intake Sessions</h2>
        <p class="text-gray-500 text-sm font-['Inter']">Choose an intake period that works for you and apply before the deadline.</p>
      </div>

      {% regroup active_intakes by year as year_groups %}

      {% for year_group in year_groups %}
      <div class="mb-8 last:mb-0">
        <div class="year-group-header mb-4">
          <span class="font-['Poppins'] text-base font-bold text-gray-700">{{ year_group.grouper }}</span>
        </div>
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for intake in year_group.list %}
          <div class="bg-white rounded-2xl border border-gray-200 p-5 flex flex-col gap-3 hover:border-purple-300 hover:shadow-md transition-all duration-200">
            <div class="flex items-center justify-between">
              <span class="text-xs font-bold uppercase tracking-wide px-2.5 py-1 rounded-full intake-{{ intake.intake_period }} font-['Inter']">
                {{ intake.get_intake_period_display }}
              </span>
              {% if intake.is_active %}
              <span class="flex items-center gap-1 text-xs text-green-600 font-semibold font-['Inter']">
                <span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span>Open
              </span>
              {% else %}
              <span class="flex items-center gap-1 text-xs text-gray-400 font-semibold font-['Inter']">
                <span class="w-1.5 h-1.5 bg-gray-300 rounded-full"></span>Closed
              </span>
              {% endif %}
            </div>

            <div class="space-y-1.5 text-xs font-['Inter']">
              <div class="flex items-center gap-2 text-gray-600">
                <i data-lucide="calendar-days" class="w-3.5 h-3.5 text-primary-400 flex-shrink-0" aria-hidden="true"></i>
                <span>Starts: <strong class="text-gray-800">{{ intake.start_date|date:"d M Y" }}</strong></span>
              </div>
              <div class="flex items-center gap-2 text-gray-600">
                <i data-lucide="calendar-clock" class="w-3.5 h-3.5 text-amber-400 flex-shrink-0" aria-hidden="true"></i>
                <span>Deadline: <strong class="text-gray-800">{{ intake.application_deadline|date:"d M Y" }}</strong></span>
              </div>
              {% if intake.available_slots %}
              <div class="flex items-center gap-2 text-gray-600">
                <i data-lucide="users" class="w-3.5 h-3.5 text-purple-400 flex-shrink-0" aria-hidden="true"></i>
                <span>Slots: <strong class="text-gray-800">{{ intake.available_slots }}</strong> available</span>
              </div>
              {% endif %}
            </div>

            {% if intake.is_active %}
            <a href="{% url 'eduweb:apply' %}"
               class="mt-auto inline-flex items-center justify-center gap-1.5 w-full px-3 py-2.5 rounded-xl text-xs font-semibold bg-primary-950 text-white hover:bg-primary-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-1 font-['Inter']">
              Apply for This Intake
              <i data-lucide="arrow-right" class="w-3 h-3" aria-hidden="true"></i>
            </a>
            {% else %}
            <span class="mt-auto inline-flex items-center justify-center gap-1.5 w-full px-3 py-2.5 rounded-xl text-xs font-medium bg-gray-100 text-gray-400 cursor-not-allowed font-['Inter']">
              Applications Closed
            </span>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- ══════════════════════════════════════════════════
       COURSES IN THIS PROGRAM
       Grouped by Year of Study → Semester
  ══════════════════════════════════════════════════ -->
  <section id="courses" class="py-16 lg:py-24 bg-white" aria-labelledby="courses-heading">
    <div class="container mx-auto px-4 lg:px-6">

      <!-- Section header -->
      <div class="max-w-2xl mb-12">
        <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Curriculum</p>
        <h2 id="courses-heading" class="font-['Poppins'] text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
          Courses in This Program
        </h2>
        <p class="text-gray-500 text-base leading-relaxed font-['Inter']">
          The complete course list for <strong class="text-gray-700">{{ program.name }}</strong>, organised by year and semester.
        </p>
      </div>

      {% if courses %}

      <!-- Group courses by year_of_study -->
      {% regroup courses by year_of_study as year_groups %}

      <div class="space-y-12">
        {% for year_group in year_groups %}
        <div>
          <!-- Year heading -->
          <div class="year-group-header mb-6">
            <div class="flex items-center gap-3">
              <div class="w-9 h-9 rounded-xl bg-primary-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
                <span class="font-['Poppins'] font-bold text-primary-700 text-sm">Y{{ year_group.grouper }}</span>
              </div>
              <h3 class="font-['Poppins'] text-xl font-bold text-gray-900">Year {{ year_group.grouper }}</h3>
            </div>
          </div>

          <!-- Group by semester within year -->
          {% regroup year_group.list by semester as semester_groups %}

          <div class="space-y-6">
            {% for semester_group in semester_groups %}
            <div>
              <!-- Semester sub-heading -->
              <div class="flex items-center gap-3 mb-4 pl-2 sem-{{ semester_group.grouper }}">
                <span class="font-['Inter'] text-xs font-bold uppercase tracking-widest text-gray-500 py-1 pl-2">
                  {{ semester_group.list.0.get_semester_display }}
                </span>
                <span class="text-xs text-gray-400 font-['Inter']">{{ semester_group.list|length }} course{% if semester_group.list|length != 1 %}s{% endif %}</span>
              </div>

              <!-- Course cards grid -->
              <div class="grid sm:grid-cols-2 xl:grid-cols-3 gap-4">
                {% for course in semester_group.list %}
                <article
                  class="course-card bg-white border border-gray-200 rounded-2xl overflow-hidden flex flex-col"
                  aria-label="{{ course.name }}">

                  <div class="h-1 bg-gradient-to-r from-primary-600 to-purple-400" aria-hidden="true"></div>

                  <div class="p-5 flex flex-col flex-1">

                    <!-- Header row -->
                    <div class="flex items-start gap-3 mb-3">
                      <div class="w-9 h-9 rounded-xl bg-primary-50 flex items-center justify-center flex-shrink-0 mt-0.5" aria-hidden="true">
                        <i data-lucide="{{ course.icon|default:'book-open' }}" class="w-4 h-4 text-primary-700"></i>
                      </div>
                      <div class="flex-1 min-w-0">
                        <div class="flex flex-wrap items-center gap-1.5 mb-1">
                          <span class="text-xs font-bold uppercase px-2 py-0.5 rounded ctype-{{ course.course_type }} font-['Inter']">
                            {{ course.get_course_type_display }}
                          </span>
                        </div>
                        <h4 class="font-['Poppins'] text-sm font-bold text-gray-900 leading-snug">{{ course.name }}</h4>
                        <p class="text-xs text-gray-400 font-mono mt-0.5">{{ course.code }}</p>
                      </div>
                    </div>

                    {% if course.description %}
                    <p class="text-xs text-gray-500 leading-relaxed mb-4 flex-1 line-clamp-3 font-['Inter']">{{ course.description }}</p>
                    {% else %}
                    <div class="flex-1"></div>
                    {% endif %}

                    <!-- Course meta -->
                    <ul class="flex flex-wrap gap-x-3 gap-y-1.5 text-xs text-gray-400 pt-3 border-t border-gray-50 font-['Inter']"
                        aria-label="Course details">
                      <li class="flex items-center gap-1.5">
                        <i data-lucide="award" class="w-3.5 h-3.5 text-primary-400" aria-hidden="true"></i>
                        {{ course.credit_units }} credit{% if course.credit_units != 1 %}s{% endif %}
                      </li>
                      <li class="flex items-center gap-1.5">
                        <i data-lucide="calendar" class="w-3.5 h-3.5 text-primary-400" aria-hidden="true"></i>
                        Yr {{ course.year_of_study }}
                      </li>
                      <li class="flex items-center gap-1.5">
                        <i data-lucide="layers" class="w-3.5 h-3.5 text-primary-400" aria-hidden="true"></i>
                        {{ course.get_semester_display }}
                      </li>
                      {% if course.lecturer %}
                      <li class="flex items-center gap-1.5 w-full mt-1">
                        <i data-lucide="user" class="w-3.5 h-3.5 text-purple-400" aria-hidden="true"></i>
                        {{ course.lecturer.get_full_name|default:course.lecturer.username }}
                      </li>
                      {% endif %}
                    </ul>

                  </div>
                </article>
                {% endfor %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Summary row -->
      <div class="mt-12 flex flex-wrap items-center justify-between gap-4 pt-8 border-t border-gray-100">
        <p class="text-sm text-gray-500 font-['Inter']">
          <strong class="text-gray-700">{{ courses|length }}</strong> course{% if courses|length != 1 %}s{% endif %} total ·
          <strong class="text-gray-700">{{ program.credits_required }}</strong> credits required to graduate
        </p>
        <a href="{% url 'eduweb:apply' %}"
           class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-semibold bg-primary-950 text-white hover:bg-primary-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 font-['Inter']">
          Apply to This Program
          <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
        </a>
      </div>

      {% else %}
      <!-- Empty state -->
      <div class="flex flex-col items-center justify-center text-center py-20 rounded-2xl border-2 border-dashed border-gray-200 bg-gray-50" role="status">
        <i data-lucide="folder-open" class="w-12 h-12 text-gray-300 mb-3" aria-hidden="true"></i>
        <p class="font-semibold text-gray-400 font-['Poppins']">No courses have been added to this program yet</p>
        <p class="text-sm text-gray-400 mt-1 font-['Inter']">Check back soon, or contact the faculty office for more information.</p>
      </div>
      {% endif %}

    </div>
  </section>

  <!-- ══════════════════════════════════════════════════
       SPECIALIZATION TRACKS
  ══════════════════════════════════════════════════ -->
  {% if program.specialization_tracks %}
  <section class="py-16 bg-gray-50" aria-labelledby="tracks-heading">
    <div class="container mx-auto px-4 lg:px-6 max-w-4xl">
      <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Focus Areas</p>
      <h2 id="tracks-heading" class="font-['Poppins'] text-3xl font-bold text-gray-900 mb-8">Specialization Tracks</h2>
      <div class="grid sm:grid-cols-2 gap-4">
        {% for track in program.specialization_tracks %}
        <div class="bg-white rounded-2xl border border-gray-100 p-5 flex items-center gap-4 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200">
          <div class="w-10 h-10 rounded-xl bg-purple-50 flex items-center justify-center flex-shrink-0" aria-hidden="true">
            <i data-lucide="git-branch" class="w-5 h-5 text-purple-600"></i>
          </div>
          <span class="font-['Poppins'] text-sm font-semibold text-gray-800">{{ track }}</span>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}

  <!-- ══════════════════════════════════════════════════
       WHY THIS PROGRAM
  ══════════════════════════════════════════════════ -->
  <section class="py-16 {% if program.specialization_tracks %}bg-white{% else %}bg-gray-50{% endif %}" aria-labelledby="why-heading">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-2xl mb-12">
        <p class="text-primary-700 text-xs font-bold uppercase tracking-widest mb-2 font-['Inter']">Advantages</p>
        <h2 id="why-heading" class="font-['Poppins'] text-3xl font-bold text-gray-900">Why Choose This Program?</h2>
      </div>

      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5 max-w-5xl">

        <article class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200">
          <div class="w-11 h-11 rounded-xl bg-primary-50 flex items-center justify-center mb-4" aria-hidden="true">
            <i data-lucide="building-2" class="w-5 h-5 text-primary-700"></i>
          </div>
          <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-2">Industry Partnerships</h3>
          <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Collaborate with leading companies through internships and real-world projects.</p>
        </article>

        <article class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200">
          <div class="w-11 h-11 rounded-xl bg-purple-50 flex items-center justify-center mb-4" aria-hidden="true">
            <i data-lucide="users" class="w-5 h-5 text-purple-600"></i>
          </div>
          <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-2">Expert Faculty</h3>
          <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Learn from seasoned professionals and active researchers in the field.</p>
        </article>

        <article class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200">
          <div class="w-11 h-11 rounded-xl bg-amber-50 flex items-center justify-center mb-4" aria-hidden="true">
            <i data-lucide="hammer" class="w-5 h-5 text-amber-600"></i>
          </div>
          <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-2">Hands-On Experience</h3>
          <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Practical projects and lab work from your very first semester.</p>
        </article>

        <article class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200">
          <div class="w-11 h-11 rounded-xl bg-primary-50 flex items-center justify-center mb-4" aria-hidden="true">
            <i data-lucide="globe" class="w-5 h-5 text-primary-700"></i>
          </div>
          <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-2">Global Network</h3>
          <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Join a worldwide community of alumni and professional connections.</p>
        </article>

        <article class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200">
          <div class="w-11 h-11 rounded-xl bg-purple-50 flex items-center justify-center mb-4" aria-hidden="true">
            <i data-lucide="cpu" class="w-5 h-5 text-purple-600"></i>
          </div>
          <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-2">Modern Facilities</h3>
          <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">State-of-the-art labs and cutting-edge technology infrastructure.</p>
        </article>

        <article class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200">
          <div class="w-11 h-11 rounded-xl bg-amber-50 flex items-center justify-center mb-4" aria-hidden="true">
            <i data-lucide="rocket" class="w-5 h-5 text-amber-600"></i>
          </div>
          <h3 class="font-['Poppins'] text-sm font-bold text-gray-900 mb-2">Career Services</h3>
          <p class="text-xs text-gray-500 leading-relaxed font-['Inter']">Dedicated placement support, CV workshops, and employer connections.</p>
        </article>

      </div>
    </div>
  </section>

  <!-- ══════════════════════════════════════════════════
       CTA BANNER
  ══════════════════════════════════════════════════ -->
  <section class="py-20 bg-white" aria-labelledby="cta-heading">
    <div class="container mx-auto px-4 lg:px-6">
      <div class="max-w-5xl mx-auto bg-gradient-to-br from-primary-950 via-primary-900 to-purple-900 rounded-3xl px-8 py-14 lg:px-16 relative overflow-hidden">
        <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
          <div class="absolute -bottom-16 -right-16 w-64 h-64 bg-purple-600 rounded-full blur-3xl opacity-30"></div>
          <div class="absolute top-0 left-0 w-48 h-48 bg-primary-700 rounded-full blur-3xl opacity-20"></div>
        </div>
        <div class="relative z-10 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-8">
          <div class="flex-1">
            <p class="text-purple-300 text-xs font-bold uppercase tracking-widest mb-3 font-['Inter']">Next Steps</p>
            <h2 id="cta-heading" class="font-['Poppins'] text-2xl lg:text-3xl font-bold text-white mb-3">
              Ready to Enrol in {{ program.name }}?
            </h2>
            <p class="text-purple-200 text-sm leading-relaxed max-w-lg font-['Inter']">
              Take the first step. Apply today and our admissions team will guide you through every stage of the process.
            </p>
          </div>
          <div class="flex flex-wrap gap-3 flex-shrink-0">
            <a href="{% url 'eduweb:apply' %}"
               class="inline-flex items-center gap-2 px-6 py-3 bg-white text-primary-950 rounded-xl font-semibold text-sm hover:bg-purple-50 hover:scale-105 transition-all duration-300 shadow-xl shadow-black/20 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950 font-['Inter']">
              Apply Now
              <i data-lucide="arrow-right" class="w-4 h-4" aria-hidden="true"></i>
            </a>
            {% if faculty %}
            <a href="{% url 'eduweb:faculty_detail' faculty.slug %}"
               class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-sm text-white transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary-950 font-['Inter']"
               style="border:1.5px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.08);">
              Back to Faculty
              <i data-lucide="arrow-left" class="w-4 h-4" aria-hidden="true"></i>
            </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>

</main>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  lucide.createIcons();
});
</script>
{% endblock %}