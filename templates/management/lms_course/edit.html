{% extends 'management/base.html' %}
{% load static %}

{% block title %}Edit LMS Course - MIU Portal{% endblock %}

{% block content %}
<div class="max-w-12xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex items-center gap-4">
        <a href="{% url 'management:lms_courses_list' %}" class="p-2 hover:bg-gray-100 rounded-lg">
            <i class="fas fa-arrow-left text-gray-600"></i>
        </a>
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Edit LMS Course</h1>
            <p class="text-gray-600 mt-1">Update course information: {{ course.title }}</p>
        </div>
    </div>

    <!-- Form -->
    <form method="post" enctype="multipart/form-data" class="bg-white rounded-lg border border-gray-200 overflow-hidden">
        {% csrf_token %}
        
        <div class="p-8 space-y-8">
            <!-- Basic Information -->
            <div>
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-info-circle mr-3 text-primary-600"></i>Basic Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Course Title <span class="text-red-500">*</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}<p class="mt-1 text-sm text-red-600">{{ form.title.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Course Code <span class="text-red-500">*</span>
                        </label>
                        {{ form.code }}
                        {% if form.code.errors %}<p class="mt-1 text-sm text-red-600">{{ form.code.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Category <span class="text-red-500">*</span>
                        </label>
                        {{ form.category }}
                        {% if form.category.errors %}<p class="mt-1 text-sm text-red-600">{{ form.category.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                        {{ form.language }}
                        {% if form.language.errors %}<p class="mt-1 text-sm text-red-600">{{ form.language.errors.0 }}</p>{% endif %}
                    </div>
                </div>
            </div>

            <!-- Descriptions -->
            <div class="pt-8 border-t border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-file-alt mr-3 text-primary-600"></i>Descriptions
                </h2>
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Short Description <span class="text-red-500">*</span>
                        </label>
                        {{ form.short_description }}
                        {% if form.short_description.errors %}<p class="mt-1 text-sm text-red-600">{{ form.short_description.errors.0 }}</p>{% endif %}
                        <p class="text-xs text-gray-500 mt-1">Max 500 characters - used in course listings</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Full Description <span class="text-red-500">*</span>
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}<p class="mt-1 text-sm text-red-600">{{ form.description.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Learning Objectives
                        </label>
                        {{ form.learning_objectives_text }}
                        {% if form.learning_objectives_text.errors %}<p class="mt-1 text-sm text-red-600">{{ form.learning_objectives_text.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Prerequisites
                        </label>
                        {{ form.prerequisites_text }}
                        {% if form.prerequisites_text.errors %}<p class="mt-1 text-sm text-red-600">{{ form.prerequisites_text.errors.0 }}</p>{% endif %}
                    </div>
                </div>
            </div>

            <!-- Course Details -->
            <div class="pt-8 border-t border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-sliders-h mr-3 text-primary-600"></i>Course Details
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty Level</label>
                        {{ form.difficulty_level }}
                        {% if form.difficulty_level.errors %}<p class="mt-1 text-sm text-red-600">{{ form.difficulty_level.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Duration (Hours)</label>
                        {{ form.duration_hours }}
                        {% if form.duration_hours.errors %}<p class="mt-1 text-sm text-red-600">{{ form.duration_hours.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Max Students</label>
                        {{ form.max_students }}
                        {% if form.max_students.errors %}<p class="mt-1 text-sm text-red-600">{{ form.max_students.errors.0 }}</p>{% endif %}
                        <p class="text-xs text-gray-500 mt-1">Leave empty for unlimited</p>
                    </div>
                </div>
            </div>

            <!-- Instructor -->
            <div class="pt-8 border-t border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-chalkboard-user mr-3 text-primary-600"></i>Instructor
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Instructor</label>
                        {{ form.instructor }}
                        {% if form.instructor.errors %}<p class="mt-1 text-sm text-red-600">{{ form.instructor.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Instructor Name</label>
                        {{ form.instructor_name }}
                        {% if form.instructor_name.errors %}<p class="mt-1 text-sm text-red-600">{{ form.instructor_name.errors.0 }}</p>{% endif %}
                        <p class="text-xs text-gray-500 mt-1">If different from selected user</p>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Instructor Biography</label>
                    {{ form.instructor_bio }}
                    {% if form.instructor_bio.errors %}<p class="mt-1 text-sm text-red-600">{{ form.instructor_bio.errors.0 }}</p>{% endif %}
                </div>
            </div>

            <!-- Media -->
            <div class="pt-8 border-t border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-image mr-3 text-primary-600"></i>Media
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Course Thumbnail</label>
                        {% if course.thumbnail %}
                        <div class="mb-3">
                            <img src="{{ course.thumbnail.url }}" alt="Current thumbnail" class="h-40 w-full object-cover rounded-lg border border-gray-300">
                        </div>
                        {% endif %}
                        {{ form.thumbnail }}
                        {% if form.thumbnail.errors %}<p class="mt-1 text-sm text-red-600">{{ form.thumbnail.errors.0 }}</p>{% endif %}
                        <p class="text-xs text-gray-500 mt-1">Recommended: 300x200px</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Promo Video URL</label>
                        {{ form.promo_video_url }}
                        {% if form.promo_video_url.errors %}<p class="mt-1 text-sm text-red-600">{{ form.promo_video_url.errors.0 }}</p>{% endif %}
                        <p class="text-xs text-gray-500 mt-1">YouTube or Vimeo link</p>
                    </div>
                </div>
            </div>

            <!-- Enrollment -->
            <div class="pt-8 border-t border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-calendar-alt mr-3 text-primary-600"></i>Enrollment Period
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Enrollment Start</label>
                        {{ form.enrollment_start_date }}
                        {% if form.enrollment_start_date.errors %}<p class="mt-1 text-sm text-red-600">{{ form.enrollment_start_date.errors.0 }}</p>{% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Enrollment End</label>
                        {{ form.enrollment_end_date }}
                        {% if form.enrollment_end_date.errors %}<p class="mt-1 text-sm text-red-600">{{ form.enrollment_end_date.errors.0 }}</p>{% endif %}
                    </div>
                </div>
            </div>

            <!-- Certificate -->
            <div class="pt-8 border-t border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-certificate mr-3 text-primary-600"></i>Certificate
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex items-start">
                        <div class="flex items-center h-5 mt-1">
                            {{ form.has_certificate }}
                        </div>
                        <div class="ml-3">
                            <label class="text-sm font-medium text-gray-700">Issue Certificate on Completion</label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Certificate Template</label>
                        {{ form.certificate_template }}
                        {% if form.certificate_template.errors %}<p class="mt-1 text-sm text-red-600">{{ form.certificate_template.errors.0 }}</p>{% endif %}
                    </div>
                </div>
            </div>

            <!-- SEO & Status -->
            <div class="pt-8 border-t border-gray-200">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-search mr-3 text-primary-600"></i>SEO & Status
                </h2>
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Meta Description</label>
                        {{ form.meta_description }}
                        {% if form.meta_description.errors %}<p class="mt-1 text-sm text-red-600">{{ form.meta_description.errors.0 }}</p>{% endif %}
                        <p class="text-xs text-gray-500 mt-1">160 characters for search results</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Meta Keywords</label>
                        {{ form.meta_keywords }}
                        {% if form.meta_keywords.errors %}<p class="mt-1 text-sm text-red-600">{{ form.meta_keywords.errors.0 }}</p>{% endif %}
                        <p class="text-xs text-gray-500 mt-1">Comma-separated keywords</p>
                    </div>
                    
                    <div>
                        <div class="flex items-center gap-6">
                            <div class="flex items-start">
                                <div class="flex items-center h-5 mt-1">
                                    {{ form.is_published }}
                                </div>
                                <div class="ml-3">
                                    <label class="text-sm font-medium text-gray-700">Published</label>
                                    <p class="text-xs text-gray-500">Make visible to students</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start">
                                <div class="flex items-center h-5 mt-1">
                                    {{ form.is_featured }}
                                </div>
                                <div class="ml-3">
                                    <label class="text-sm font-medium text-gray-700">Featured</label>
                                    <p class="text-xs text-gray-500">Highlight on homepage</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="px-8 py-6 bg-gray-50 border-t border-gray-200 flex justify-between">
            <a href="{% url 'management:lms_courses_list' %}" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100">
                Cancel
            </a>
            <button type="submit" class="px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700">
                <i class="fas fa-save mr-2"></i>Update Course
            </button>
        </div>
    </form>
</div>
{% endblock %}
