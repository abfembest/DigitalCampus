{% extends "management/base.html" %}
{% load static %}

{% block title %}{{ page_title }} - MIU Student Portal{% endblock %}

{% block meta_description %}
View and manage your enrolled courses. Track progress, 
continue learning, and access course materials.
{% endblock %}

{% block content %}
<div class="max-w-12xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <header class="mb-6 lg:mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">
            My Courses
        </h1>
        <p class="text-sm sm:text-base text-gray-600 mt-2">
            Track your learning journey
        </p>
    </header>

    <!-- Filters -->
    <nav 
        class="bg-white rounded-xl shadow-sm border 
               border-gray-200 p-4 mb-6"
        aria-label="Course status filter">
        <div class="flex items-center space-x-4 overflow-x-auto">
            <a 
                href="?status=active" 
                class="px-4 py-2 rounded-lg whitespace-nowrap
                       transition-colors
                       {% if status_filter == 'active' %}
                       bg-primary-600 text-white
                       {% else %}
                       bg-gray-100 text-gray-700 
                       hover:bg-gray-200
                       {% endif %}
                       focus:outline-none focus:ring-2 
                       focus:ring-primary-500 
                       focus:ring-offset-2"
                {% if status_filter == 'active' %}
                aria-current="page"
                {% endif %}>
                <i class="fas fa-book-open mr-2" 
                   aria-hidden="true"></i>
                Active
            </a>
            
            <a 
                href="?status=completed" 
                class="px-4 py-2 rounded-lg whitespace-nowrap
                       transition-colors
                       {% if status_filter == 'completed' %}
                       bg-primary-600 text-white
                       {% else %}
                       bg-gray-100 text-gray-700 
                       hover:bg-gray-200
                       {% endif %}
                       focus:outline-none focus:ring-2 
                       focus:ring-primary-500 
                       focus:ring-offset-2"
                {% if status_filter == 'completed' %}
                aria-current="page"
                {% endif %}>
                <i class="fas fa-check-circle mr-2" 
                   aria-hidden="true"></i>
                Completed
            </a>
        </div>
    </nav>

    <!-- Courses Grid -->
    {% if enrollments %}
    <div class="grid grid-cols-1 md:grid-cols-2 
                lg:grid-cols-3 xl:grid-cols-4 
                gap-4 sm:gap-6">
        {% for enrollment in enrollments %}
        <article 
            class="bg-white rounded-xl shadow-sm border 
                   border-gray-200 overflow-hidden 
                   hover:shadow-lg transition-shadow">
            
            <!-- Course Thumbnail -->
            <div class="h-40 bg-gradient-to-br 
                        from-primary-500 to-secondary-500 
                        relative">
                {% if enrollment.course.thumbnail %}
                <img 
                    src="{{ enrollment.course.thumbnail.url }}" 
                    alt="{{ enrollment.course.title }}" 
                    class="w-full h-full object-cover"
                    loading="lazy">
                {% else %}
                <div class="w-full h-full flex items-center 
                            justify-center">
                    <i class="fas fa-book text-white 
                              text-5xl opacity-50" 
                       aria-hidden="true"></i>
                </div>
                {% endif %}
                
                <!-- Status Badge -->
                <div class="absolute top-3 right-3">
                    {% if enrollment.status == 'completed' %}
                    <span class="px-3 py-1 bg-green-500 
                                 text-white rounded-full text-xs 
                                 font-semibold">
                        <i class="fas fa-check mr-1" 
                           aria-hidden="true"></i>
                        Completed
                    </span>
                    {% elif enrollment.status == 'active' %}
                    <span class="px-3 py-1 bg-blue-500 
                                 text-white rounded-full text-xs 
                                 font-semibold">
                        <i class="fas fa-play mr-1" 
                           aria-hidden="true"></i>
                        In Progress
                    </span>
                    {% endif %}
                </div>
            </div>

            <div class="p-4 sm:p-5">
                <!-- Category -->
                {% if enrollment.course.category %}
                <span class="px-3 py-1 bg-blue-100 
                             text-blue-700 rounded-full text-xs 
                             font-medium mb-3 inline-block">
                    {{ enrollment.course.category.name }}
                </span>
                {% endif %}

                <!-- Course Title -->
                <h2 class="text-base sm:text-lg font-bold 
                           text-gray-900 mb-2 line-clamp-2 
                           min-h-[3.5rem]">
                    {{ enrollment.course.title }}
                </h2>

                <!-- Instructor -->
                <p class="text-xs sm:text-sm text-gray-600 
                          mb-4 truncate">
                    <i class="fas fa-user-tie mr-1" 
                       aria-hidden="true"></i>
                    {{ enrollment.course.instructor_name|default:'MIU Staff' }}
                </p>

                <!-- Progress -->
                <div class="mb-4">
                    <div class="flex items-center justify-between 
                                mb-2 text-xs sm:text-sm">
                        <span class="text-gray-600">Progress</span>
                        <span class="font-semibold text-gray-900">
                            {{ enrollment.progress_percentage|floatformat:0 }}%
                        </span>
                    </div>
                    
                    <div class="w-full bg-gray-200 rounded-full 
                                h-2.5"
                         role="progressbar"
                         aria-valuenow="{{ enrollment.progress_percentage }}"
                         aria-valuemin="0"
                         aria-valuemax="100">
                        <div class="h-2.5 rounded-full 
                                    transition-all duration-500
                                    {% if enrollment.progress_percentage == 100 %}
                                    bg-green-500
                                    {% else %}
                                    bg-primary-600
                                    {% endif %}" 
                             style="width: {{ enrollment.progress_percentage }}%">
                        </div>
                    </div>
                    
                    <p class="text-xs text-gray-500 mt-1">
                        {{ enrollment.completed_lessons_count }} 
                        of 
                        {{ enrollment.course.active_lessons|length }} 
                        lesson{{ enrollment.course.active_lessons|length|pluralize }}
                    </p>
                </div>

                <!-- Enrollment Info -->
                <div class="text-xs text-gray-500 mb-4 pb-4 
                            border-b border-gray-200">
                    <div class="flex items-center mb-1">
                        <i class="fas fa-calendar mr-1 
                                  flex-shrink-0" 
                           aria-hidden="true"></i>
                        <time datetime="{{ enrollment.enrolled_at|date:'c' }}">
                            Enrolled: {{ enrollment.enrolled_at|date:"M d, Y" }}
                        </time>
                    </div>
                    
                    {% if enrollment.last_accessed %}
                    <div class="flex items-center">
                        <i class="fas fa-clock mr-1 flex-shrink-0" 
                           aria-hidden="true"></i>
                        <time datetime="{{ enrollment.last_accessed|date:'c' }}">
                            Last accessed: 
                            {{ enrollment.last_accessed|date:"M d, Y" }}
                        </time>
                    </div>
                    {% endif %}
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-2">
                    {% if enrollment.status == 'completed' %}
                    <a 
                        href="{% url 'students:course_detail' enrollment.course.slug %}" 
                        class="flex-1 text-center px-3 sm:px-4 
                               py-2 sm:py-2.5 bg-gray-600 
                               text-white rounded-lg 
                               hover:bg-gray-700 
                               focus:outline-none focus:ring-2 
                               focus:ring-gray-500 
                               focus:ring-offset-2 
                               transition-colors font-medium 
                               text-sm">
                        <i class="fas fa-eye mr-2"></i>
                        Review
                    </a>
                    {% else %}
                    <a 
                        href="{% url 'students:course_detail' enrollment.course.slug %}" 
                        class="flex-1 text-center px-3 sm:px-4 
                               py-2 sm:py-2.5 bg-primary-600 
                               text-white rounded-lg 
                               hover:bg-primary-700 
                               focus:outline-none focus:ring-2 
                               focus:ring-primary-500 
                               focus:ring-offset-2 
                               transition-colors font-medium 
                               text-sm">
                        <i class="fas fa-play-circle mr-2"></i>
                        Continue
                    </a>
                    {% endif %}
                    
                    {% if enrollment.status == 'completed' and enrollment.course.has_certificate %}
                    <a 
                        href="{% url 'students:certificates' %}" 
                        class="px-3 sm:px-4 py-2 sm:py-2.5 
                               bg-yellow-500 text-white 
                               rounded-lg hover:bg-yellow-600 
                               focus:outline-none focus:ring-2 
                               focus:ring-yellow-500 
                               focus:ring-offset-2 
                               transition-colors text-sm"
                        title="View certificate"
                        aria-label="View certificate for {{ enrollment.course.title }}">
                        <i class="fas fa-certificate"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    
    <!-- Empty State -->
    <div class="bg-white rounded-xl shadow-sm border 
                border-gray-200 p-8 sm:p-12">
        <div class="text-center max-w-md mx-auto">
            <i class="fas fa-book-open text-5xl sm:text-6xl 
                      text-gray-300 mb-4" 
               aria-hidden="true"></i>
            
            <h3 class="text-lg sm:text-xl font-semibold 
                       text-gray-900 mb-2">
                No courses found
            </h3>
            
            <p class="text-sm sm:text-base text-gray-600 mb-6">
                {% if status_filter == 'active' %}
                You don't have any active courses yet
                {% elif status_filter == 'completed' %}
                You haven't completed any courses yet
                {% endif %}
            </p>
            
            <a 
                href="{% url 'students:course_catalog' %}" 
                class="inline-block px-4 sm:px-6 
                       py-2 sm:py-3 bg-primary-600 
                       text-white rounded-lg 
                       hover:bg-primary-700 
                       focus:outline-none focus:ring-2 
                       focus:ring-primary-500 
                       focus:ring-offset-2 
                       transition-colors font-semibold 
                       text-sm sm:text-base">
                <i class="fas fa-search mr-2" 
                   aria-hidden="true"></i>
                Browse Course Catalog
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}